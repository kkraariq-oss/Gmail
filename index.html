<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø¹Ù… - Restaurant Management System</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    
    <!-- SheetJS Ù„Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <!-- jsPDF Ù„Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700;900&display=swap');

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --transition-speed: 0.3s;
            --navbar-height: 70px;
            --radius-2xl: 24px;
            --radius-xl: 18px;
            --radius-lg: 12px;
            --radius-md: 8px;
            --shadow-sm: 0 2px 8px rgba(0,0,0,0.08);
            --shadow-md: 0 4px 16px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 32px rgba(0,0,0,0.12);
        }

        /* Ø«ÙŠÙ… ÙØ§ØªØ­ */
        .light-theme {
            --bg-primary: #faf8f3;
            --bg-secondary: #ffffff;
            --bg-tertiary: #f5f3ed;
            --text-primary: #2c3e50;
            --text-secondary: #7f8c8d;
            --text-tertiary: #95a5a6;
            --border-color: #e1e8ed;
            --primary-color: #7c3aed;
            --secondary-color: #5f27cd;
            --accent-color: #f39c12;
            --success-color: #27ae60;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --info-color: #3498db;
            --gradient-primary: linear-gradient(135deg, #7c3aed 0%, #5f27cd 100%);
        }

        /* Ø«ÙŠÙ… Ø¯Ø§ÙƒÙ† */
        .dark-theme {
            --bg-primary: #0a0a0a;
            --bg-secondary: #1a1a1a;
            --bg-tertiary: #252525;
            --text-primary: #ffd700;
            --text-secondary: #f5e6b3;
            --text-tertiary: #d4af37;
            --border-color: #3a3a3a;
            --primary-color: #ffd700;
            --secondary-color: #d4af37;
            --accent-color: #ffd700;
            --success-color: #ffd700;
            --danger-color: #ff6b6b;
            --warning-color: #f39c12;
            --info-color: #ffd700;
            --gradient-primary: linear-gradient(135deg, #1a1a1a 0%, #0a0a0a 100%);
            --gradient-gold: linear-gradient(135deg, #ffd700 0%, #d4af37 100%);
        }

        body {
            font-family: 'Cairo', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
            min-height: 100vh;
            transition: all var(--transition-speed) ease;
        }

        .custom-titlebar {
            height: 70px;
            background: var(--bg-secondary);
            border-bottom: 2px solid var(--border-color);
            -webkit-app-region: drag;
            user-select: none;
            box-shadow: var(--shadow-sm);
            transition: all var(--transition-speed) ease;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .titlebar-drag-region {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            padding: 0 20px;
        }

        .titlebar-left, .titlebar-center, .titlebar-right {
            display: flex;
            align-items: center;
            gap: 15px;
            -webkit-app-region: no-drag;
        }

        .app-icon {
            font-size: 32px;
            color: var(--primary-color);
            animation: rotate 20s linear infinite;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .app-title {
            display: flex;
            flex-direction: column;
        }

        .main-title {
            font-size: 18px;
            font-weight: 700;
            color: var(--text-primary);
        }

        .sub-title {
            font-size: 12px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        .company-contact {
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--bg-tertiary);
            padding: 8px 15px;
            border-radius: 20px;
        }

        .phone-number {
            font-size: 13px;
            font-weight: 600;
            color: var(--text-primary);
            direction: ltr;
        }

        .whatsapp-btn-title {
            background: #25D366;
            color: white;
            border: none;
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .whatsapp-btn-title:hover {
            transform: scale(1.1);
            box-shadow: 0 4px 12px rgba(37, 211, 102, 0.4);
        }

        .theme-toggle {
            background: var(--gradient-primary);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            color: white;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            font-size: 18px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            transform: scale(1.05) rotate(20deg);
            box-shadow: var(--shadow-md);
        }

        .titlebar-button {
            width: 40px;
            height: 40px;
            border: none;
            background: transparent;
            color: var(--text-primary);
            cursor: pointer;
            border-radius: 8px;
            transition: all 0.3s ease;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .titlebar-button:hover {
            background: var(--bg-tertiary);
        }

        .titlebar-button.close-btn:hover {
            background: #e74c3c;
            color: white;
        }

        .notification {
            position: fixed;
            top: 90px;
            left: 50%;
            transform: translateX(-50%);
            padding: 15px 25px;
            border-radius: 8px;
            box-shadow: var(--shadow-lg);
            z-index: 9999;
            display: none;
            animation: slideDown 0.3s ease;
            max-width: 500px;
            text-align: center;
            font-weight: 600;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translate(-50%, -20px);
            }
            to {
                opacity: 1;
                transform: translate(-50%, 0);
            }
        }

        .notification.success { background: var(--success-color); color: white; }
        .notification.error { background: var(--danger-color); color: white; }
        .notification.warning { background: var(--warning-color); color: white; }
        .notification.info { background: var(--info-color); color: white; }

        .login-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
            background: var(--gradient-primary);
        }

        .login-container {
            background: var(--bg-secondary);
            border-radius: var(--radius-2xl);
            box-shadow: var(--shadow-lg);
            padding: 40px;
            width: 100%;
            max-width: 450px;
            animation: slideIn 0.5s ease;
            border: 1px solid var(--border-color);
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo i {
            font-size: 60px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }

        .login-logo h1 {
            font-size: 24px;
            color: var(--text-primary);
            font-weight: 700;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: var(--text-primary);
            font-weight: 600;
            font-size: 14px;
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 2px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            font-family: 'Cairo', sans-serif;
            transition: all 0.3s ease;
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(124, 58, 237, 0.1);
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: var(--radius-lg);
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Cairo', sans-serif;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .btn-primary { background: var(--primary-color); color: white; }
        .btn-success { background: var(--success-color); color: white; }
        .btn-danger { background: var(--danger-color); color: white; }
        .btn-warning { background: var(--warning-color); color: white; }
        .btn-info { background: var(--info-color); color: white; }
        .btn-secondary { background: #95a5a6; color: white; }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            opacity: 0.9;
        }

        .btn-block { width: 100%; }
        .btn-sm { padding: 8px 16px; font-size: 13px; }
        .btn-lg { padding: 15px 30px; font-size: 16px; }

        .login-footer {
            text-align: center;
            margin-top: 25px;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        .login-footer p {
            font-size: 13px;
            color: var(--text-secondary);
        }

        .dashboard {
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background: var(--bg-primary);
        }

        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
            scroll-behavior: smooth;
            background: var(--bg-primary);
            max-height: calc(100vh - var(--navbar-height));
        }

        .page {
            display: none;
            animation: fadeIn 0.4s ease;
        }

        .page.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .page-header {
            margin-bottom: 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .page-header h2 {
            font-size: 28px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 12px;
            font-weight: 700;
        }

        .page-header h2 i {
            color: var(--primary-color);
        }

        /* Ø¨Ø·Ø§Ù‚Ø§Øª Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: var(--bg-secondary);
            padding: 25px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            display: flex;
            align-items: center;
            gap: 20px;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
            border: 1px solid var(--border-color);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius-lg);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            color: white;
        }

        .stat-card:nth-child(1) .stat-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .stat-card:nth-child(2) .stat-icon {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .stat-card:nth-child(3) .stat-icon {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .stat-card:nth-child(4) .stat-icon {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .stat-info h3 {
            font-size: 14px;
            color: var(--text-secondary);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .stat-value {
            font-size: 24px;
            font-weight: 700;
            color: var(--text-primary);
        }

        /* Ø£Ù‚Ø³Ø§Ù… Ø§Ù„Ù†Ø¸Ø§Ù… */
        .sections-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .section-card {
            background: var(--bg-secondary);
            padding: 30px;
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-md);
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .section-card:hover {
            transform: translateY(-8px);
            box-shadow: var(--shadow-lg);
        }

        .section-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 20px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 35px;
            color: white;
        }

        .section-card:nth-child(1) .section-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .section-card:nth-child(2) .section-icon {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .section-card:nth-child(3) .section-icon {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }

        .section-card:nth-child(4) .section-icon {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
        }

        .section-card:nth-child(5) .section-icon {
            background: linear-gradient(135deg, #fa709a 0%, #fee140 100%);
        }

        .section-card:nth-child(6) .section-icon {
            background: linear-gradient(135deg, #30cfd0 0%, #330867 100%);
        }

        .section-card:nth-child(7) .section-icon {
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
        }

        .section-card:nth-child(8) .section-icon {
            background: linear-gradient(135deg, #ff9a9e 0%, #fecfef 100%);
        }

        .section-card h4 {
            font-size: 18px;
            color: var(--text-primary);
            margin-bottom: 10px;
            font-weight: 700;
        }

        .section-card p {
            font-size: 14px;
            color: var(--text-secondary);
        }

        .card {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 20px;
            box-shadow: var(--shadow-md);
            margin-bottom: 20px;
            border: 1px solid var(--border-color);
        }

        .card-header {
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .card-header h3 {
            font-size: 18px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background: var(--bg-secondary);
            border-radius: var(--radius-lg);
            overflow: hidden;
        }

        thead {
            background: var(--primary-color);
            color: white;
        }

        thead th {
            padding: 15px;
            text-align: right;
            font-weight: 700;
        }

        tbody tr {
            border-bottom: 1px solid var(--border-color);
            transition: background 0.2s ease;
        }

        tbody tr:hover {
            background: var(--bg-tertiary);
        }

        tbody td {
            padding: 12px 15px;
            text-align: right;
            color: var(--text-primary);
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 10000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--bg-secondary);
            margin: 5% auto;
            padding: 30px;
            border-radius: var(--radius-xl);
            max-width: 600px;
            box-shadow: var(--shadow-lg);
            animation: slideIn 0.3s ease;
            max-height: 85vh;
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border-color);
        }

        .modal-header h3 {
            font-size: 20px;
            color: var(--text-primary);
            font-weight: 700;
        }

        .close {
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            color: var(--text-primary);
            transition: color 0.3s ease;
        }

        .close:hover {
            color: var(--danger-color);
        }

        .filters {
            background: var(--bg-secondary);
            padding: 20px;
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-sm);
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: flex-end;
            border: 1px solid var(--border-color);
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
        }

        /* Ù†Ø¸Ø§Ù… POS */
        .pos-container {
            display: grid;
            grid-template-columns: 1fr 420px;
            gap: 24px;
            height: calc(100vh - 200px);
        }

        .products-section {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 20px;
            box-shadow: var(--shadow-md);
            overflow-y: auto;
            border: 1px solid var(--border-color);
        }

        .categories-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .category-tab {
            padding: 10px 20px;
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
        }

        .category-tab.active,
        .category-tab:hover {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 15px;
        }

        .product-item {
            background: var(--bg-tertiary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .product-item:hover {
            border-color: var(--primary-color);
            transform: translateY(-5px);
            box-shadow: var(--shadow-md);
        }

        .product-image {
            width: 100%;
            height: 120px;
            object-fit: cover;
            border-radius: 8px;
            margin-bottom: 10px;
            background: var(--bg-primary);
        }

        .product-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .product-price {
            color: var(--primary-color);
            font-weight: 700;
            font-size: 16px;
        }

        .cart-section {
            background: var(--bg-secondary);
            border-radius: var(--radius-xl);
            padding: 20px;
            box-shadow: var(--shadow-md);
            display: flex;
            flex-direction: column;
            border: 1px solid var(--border-color);
        }

        .cart-header {
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 15px;
            margin-bottom: 15px;
        }

        .cart-header h3 {
            font-size: 18px;
            color: var(--text-primary);
            display: flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
        }

        .cart-items {
            flex: 1;
            overflow-y: auto;
            margin-bottom: 15px;
            max-height: 400px;
        }

        .cart-item {
            background: var(--bg-tertiary);
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .cart-item-info {
            flex: 1;
        }

        .cart-item-name {
            font-weight: 600;
            font-size: 14px;
            color: var(--text-primary);
            margin-bottom: 5px;
        }

        .cart-item-details {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .cart-item-quantity {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 5px 0;
        }

        .qty-btn {
            width: 25px;
            height: 25px;
            border: none;
            background: var(--primary-color);
            color: white;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
        }

        .qty-btn:hover {
            opacity: 0.8;
        }

        .cart-total {
            border-top: 2px solid var(--border-color);
            padding-top: 15px;
            margin-bottom: 15px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 16px;
        }

        .total-row.final {
            font-size: 20px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .cart-actions {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
        }

        .image-preview {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: 8px;
            margin-top: 10px;
        }

        ::-webkit-scrollbar {
            width: 10px;
            height: 10px;
        }

        ::-webkit-scrollbar-track {
            background: var(--bg-tertiary);
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary-color);
            border-radius: 5px;
        }

        .hidden {
            display: none !important;
        }

        /* Ø²Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ */
        .logout-btn {
            position: fixed;
            top: 15px;
            left: 15px;
            z-index: 1001;
            background: var(--danger-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .logout-btn:hover {
            background: #c82333;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.3);
        }

        /* Ø²Ø± ØªØ­Ø¯ÙŠØ« */
        .refresh-btn {
            position: fixed;
            top: 15px;
            left: 150px;
            z-index: 1001;
            background: var(--info-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s ease;
        }

        .refresh-btn:hover {
            background: #138496;
            transform: rotate(180deg);
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ */
        .registration-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, var(--primary-color) 0%, #667eea 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .registration-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 600px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .registration-header {
            text-align: center;
            margin-bottom: 30px;
        }

        .registration-header h1 {
            color: var(--primary-color);
            margin-bottom: 10px;
            font-size: 28px;
        }

        .registration-header p {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .terms-box {
            background: var(--bg-tertiary);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 2px solid var(--border-color);
        }

        .terms-box h4 {
            color: var(--danger-color);
            margin-bottom: 15px;
        }

        .terms-box ul {
            list-style: none;
            padding: 0;
        }

        .terms-box li {
            padding: 8px 0;
            color: var(--text-primary);
            font-size: 14px;
            line-height: 1.6;
        }

        .terms-box li:before {
            content: "âš ï¸ ";
            margin-left: 10px;
        }

        .checkbox-agreement {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 20px 0;
            padding: 15px;
            background: var(--bg-tertiary);
            border-radius: 10px;
            cursor: pointer;
        }

        .checkbox-agreement input[type="checkbox"] {
            width: 20px;
            height: 20px;
            cursor: pointer;
        }

        .checkbox-agreement label {
            cursor: pointer;
            user-select: none;
            font-weight: 600;
        }

        /* Ø´Ø§Ø´Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© */
        .trial-expired-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .trial-expired-card {
            background: white;
            border-radius: 20px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.5);
        }

        .trial-expired-card .icon {
            font-size: 80px;
            margin-bottom: 20px;
        }

        .trial-expired-card h2 {
            color: var(--danger-color);
            margin-bottom: 15px;
        }

        .trial-expired-card p {
            color: var(--text-secondary);
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .whatsapp-btn {
            background: #25D366;
            color: white;
            padding: 12px 30px;
            border-radius: 8px;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-weight: 700;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .whatsapp-btn:hover {
            background: #128C7E;
            transform: scale(1.05);
        }

        @media print {
            body * {
                visibility: hidden;
            }
            .print-area, .print-area * {
                visibility: visible;
            }
            .print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 80mm;
            }
        }

        .text-center {
            text-align: center;
        }

        .mt-20 {
            margin-top: 20px;
        }

        html {
            scroll-behavior: smooth;
        }

        @media (max-width: 1200px) {
            .pos-container {
                grid-template-columns: 1fr;
            }
            
            .cart-section {
                height: 500px;
            }
        }

        @media (max-width: 768px) {
            .sections-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .stats-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .main-content {
                padding: 15px;
            }

            .titlebar-drag-region {
                padding: 0 10px;
            }

            .company-contact {
                display: none;
            }

            .cart-actions {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body class="light-theme">
    
    <!-- Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ -->
    <div id="registrationScreen" class="registration-screen hidden">
        <div class="registration-card">
            <div class="registration-header">
                <h1>ğŸ½ï¸ Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Cash Pro</h1>
                <p>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø§Ø¹Ù… Ø§Ù„Ø§Ø­ØªØ±Ø§ÙÙŠ</p>
                <p style="color: var(--info-color); font-weight: 700;">Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ - Digital Creativity Company</p>
            </div>

            <form onsubmit="submitInitialRegistration(event)">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù… <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" id="regRestaurantName" required>
                </div>

                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" id="regOwnerName" required>
                </div>

                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ <span style="color: red;">*</span></label>
                    <input type="tel" class="form-control" id="regPhone" required pattern="[0-9]{11}" placeholder="07XXXXXXXXX">
                </div>

                <div class="form-group">
                    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù† <span style="color: red;">*</span></label>
                    <input type="text" class="form-control" id="regAddress" required>
                </div>

                <div class="terms-box">
                    <h4>âš ï¸ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</h4>
                    <ul>
                        <li>ÙŠØ­Ø¸Ø± Ù†Ø³Ø® Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø£Ùˆ ØªØ«Ø¨ÙŠØªÙ‡ Ø¹Ù„Ù‰ Ø£Ø¬Ù‡Ø²Ø© Ø£Ø®Ø±Ù‰ Ø¥Ù„Ø§ Ø¨Ù…ÙˆØ§ÙÙ‚Ø© Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ</li>
                        <li>Ø§Ù„ØªØ¹Ø¯ÙŠ Ø¹Ù„Ù‰ Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ù„ÙƒÙŠØ© Ø§Ù„ÙÙƒØ±ÙŠØ© ÙŠØ¹Ø±Ø¶Ùƒ Ù„Ù„Ù…Ø³Ø§Ø¡Ù„Ø© Ø§Ù„Ù‚Ø§Ù†ÙˆÙ†ÙŠØ©</li>
                        <li>Ù‚Ø¯ ØªØªØ¶Ù…Ù† Ø§Ù„Ø¹Ù‚ÙˆØ¨Ø§Øª ØºØ±Ø§Ù…Ø§Øª Ù…Ø§Ù„ÙŠØ© ÙˆØ£ØªØ¹Ø§Ø¨ Ø§Ù„Ù…Ø­Ø§Ù…Ø§Ø©</li>
                        <li>Ø±Ù‚Ù… Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨ Ù„Ù„Ø¯Ø¹Ù… Ø§Ù„ÙÙ†ÙŠ: 07813798636</li>
                        <li>ÙØªØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©: 7 Ø£ÙŠØ§Ù…</li>
                        <li>Ø³Ø¹Ø± Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ: 100 Ø¯ÙˆÙ„Ø§Ø±</li>
                    </ul>
                </div>

                <div class="checkbox-agreement">
                    <input type="checkbox" id="agreeTerms" required>
                    <label for="agreeTerms">Ø£ÙˆØ§ÙÙ‚ Ø¹Ù„Ù‰ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø´Ø±ÙˆØ· ÙˆØ§Ù„Ø£Ø­ÙƒØ§Ù…</label>
                </div>

                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-check-circle"></i>
                    Ø¨Ø¯Ø¡ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© (7 Ø£ÙŠØ§Ù… Ù…Ø¬Ø§Ù†Ø§Ù‹)
                </button>
            </form>
        </div>
    </div>

    <!-- Ø´Ø§Ø´Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© / Ø§Ù„ØªØ¬Ø¯ÙŠØ¯ -->
    <div id="trialExpiredScreen" class="trial-expired-screen hidden">
        <div class="trial-expired-card">
            <div class="icon">ğŸ”’</div>
            <h2 id="expiredTitle">Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©</h2>
            <p id="trialExpiredMessage">Ø¹Ø²ÙŠØ²ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŒ Ù„Ù‚Ø¯ Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ø¨Ø§Ù„ØºØ© 7 Ø£ÙŠØ§Ù….</p>
            <p>Ù„Ù„Ø§Ø³ØªÙ…Ø±Ø§Ø± ÙÙŠ Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ.</p>

            <a href="#" class="whatsapp-btn" id="contactWhatsAppBtn" onclick="contactCompanyForActivation()">
                <i class="fab fa-whatsapp"></i>
                ØªÙˆØ§ØµÙ„ Ù…Ø¹Ù†Ø§ Ø¹Ø¨Ø± Ø§Ù„ÙˆØ§ØªØ³Ø§Ø¨
            </a>

            <form onsubmit="activateWithCode(event)" style="margin-top: 20px;">
                <div class="form-group">
                    <label>Ø±Ù…Ø² Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</label>
                    <input type="text" class="form-control" id="activationCode" placeholder="Ø£Ø¯Ø®Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„" required style="text-align: center; font-size: 18px; letter-spacing: 2px; text-transform: uppercase;">
                </div>
                <button type="submit" class="btn btn-success btn-block">
                    <i class="fas fa-key"></i>
                    ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                </button>
            </form>
        </div>
    </div>

    <!-- Ø£Ø²Ø±Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ ÙˆØ§Ù„ØªØ­Ø¯ÙŠØ« -->
    <button class="logout-btn hidden" id="logoutBtn" onclick="logout()">
        <i class="fas fa-sign-out-alt"></i>
        ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
    </button>

    <button class="refresh-btn hidden" id="refreshBtn" onclick="refreshApp()">
        <i class="fas fa-sync-alt"></i>
        ØªØ­Ø¯ÙŠØ«
    </button>
    
    <div class="custom-titlebar">
        <div class="titlebar-drag-region">
            <div class="titlebar-left">
                <i class="fas fa-utensils app-icon"></i>
                <div class="app-title">
                    <span class="main-title">Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø¹Ù…</span>
                    <span class="sub-title">Restaurant Management System</span>
                </div>
            </div>
            
            <div class="titlebar-center">
                <div class="company-contact">
                    <span class="phone-number">07708967699</span>
                    <button class="whatsapp-btn-title" onclick="openWhatsApp()">
                        <i class="fab fa-whatsapp"></i>
                    </button>
                </div>
            </div>
            
            <div class="titlebar-right">
                <button class="theme-toggle" onclick="toggleTheme()">
                    <i class="fas fa-moon"></i>
                </button>
                <button class="titlebar-button" onclick="minimizeWindow()">
                    <i class="fas fa-window-minimize"></i>
                </button>
                <button class="titlebar-button" onclick="maximizeWindow()">
                    <i class="fas fa-window-maximize"></i>
                </button>
                <button class="titlebar-button close-btn" onclick="closeWindow()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
        </div>
    </div>

    <div id="notification" class="notification"></div>

    <!-- Ø´Ø§Ø´Ø© ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ -->
    <div class="login-screen" id="loginScreen">
        <div class="login-container">
            <div class="login-logo">
                <i class="fas fa-utensils"></i>
                <h1>Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø·Ø¹Ù…</h1>
            </div>
            <form class="login-form" onsubmit="handleLogin(event)">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" class="form-control" id="username" required>
                </div>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" class="form-control" id="password" required>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-sign-in-alt"></i>
                    ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
                </button>
            </form>
            <div class="login-footer">
                <p>Ø´Ø±ÙƒØ© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ Ø§Ù„Ø±Ù‚Ù…ÙŠ - Digital Creativity Company</p>
            </div>
        </div>
    </div>

    <!-- Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ… -->
    <div class="dashboard hidden" id="dashboard">
        <div class="main-content">
            
            <!-- Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
            <div class="page active" id="homePage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-home"></i>
                        Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©
                    </h2>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-shopping-cart"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª Ø§Ù„ÙŠÙˆÙ…</h3>
                            <div class="stat-value" id="todaySales">0 Ø¯.Ø¹</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
                            <div class="stat-value" id="invoiceCount">0</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                            <div class="stat-value" id="productCount">0</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3>ØµØ§ÙÙŠ Ø§Ù„Ø±Ø¨Ø­</h3>
                            <div class="stat-value" id="netProfit">0 Ø¯.Ø¹</div>
                        </div>
                    </div>
                </div>

                <div class="sections-grid">
                    <div class="section-card" onclick="showPage('posPage')">
                        <div class="section-icon">
                            <i class="fas fa-cash-register"></i>
                        </div>
                        <h4>Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹</h4>
                        <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª ÙˆØ§Ù„Ø·Ù„Ø¨Ø§Øª</p>
                    </div>

                    <div class="section-card" onclick="showPage('productsPage')">
                        <div class="section-icon">
                            <i class="fas fa-boxes"></i>
                        </div>
                        <h4>Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h4>
                        <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª ÙˆØ§Ù„Ø£ØµÙ†Ø§Ù</p>
                    </div>

                    <div class="section-card" onclick="showPage('categoriesPage')">
                        <div class="section-icon">
                            <i class="fas fa-th-large"></i>
                        </div>
                        <h4>Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª</h4>
                        <p>Ø¥Ø¯Ø§Ø±Ø© ØªØµÙ†ÙŠÙØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</p>
                    </div>

                    <div class="section-card" onclick="showPage('invoicesPage')">
                        <div class="section-icon">
                            <i class="fas fa-file-invoice-dollar"></i>
                        </div>
                        <h4>Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h4>
                        <p>Ø¹Ø±Ø¶ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±</p>
                    </div>

                    <div class="section-card" onclick="showPage('expensesPage')">
                        <div class="section-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <h4>Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h4>
                        <p>ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</p>
                    </div>

                    <div class="section-card" onclick="showPage('reportsPage')">
                        <div class="section-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <h4>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±</h4>
                        <p>Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª</p>
                    </div>

                    <div class="section-card" onclick="showPage('settingsPage')">
                        <div class="section-icon">
                            <i class="fas fa-cog"></i>
                        </div>
                        <h4>Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª</h4>
                        <p>Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ø¸Ø§Ù…</p>
                    </div>

                    <div class="section-card" onclick="showPage('backupPage')">
                        <div class="section-icon">
                            <i class="fas fa-database"></i>
                        </div>
                        <h4>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ</h4>
                        <p>Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ ÙˆØ§Ø³ØªØ¹Ø§Ø¯Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</p>
                    </div>

                    <div class="section-card" onclick="showPage('usersPage')" id="usersCard">
                        <div class="section-icon" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                            <i class="fas fa-users-cog"></i>
                        </div>
                        <h4>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h4>
                        <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† ÙˆØ§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</p>
                    </div>

                    <div class="section-card" onclick="showPage('employeesPage')">
                        <div class="section-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                            <i class="fas fa-user-tie"></i>
                        </div>
                        <h4>Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h4>
                        <p>Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† ÙˆØ§Ù„Ø±ÙˆØ§ØªØ¨</p>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹ -->
            <div class="page" id="posPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-cash-register"></i>
                        Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
                    </h2>
                    <button class="btn btn-secondary" onclick="showPage('homePage')">
                        <i class="fas fa-arrow-right"></i>
                        Ø¹ÙˆØ¯Ø©
                    </button>
                </div>

                <div class="pos-container">
                    <!-- Ù‚Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                    <div class="products-section">
                        <div class="categories-tabs" id="posCategories">
                            <div class="category-tab active" data-category="all">Ø§Ù„ÙƒÙ„</div>
                        </div>
                        <div class="products-grid" id="posProductsGrid">
                            <!-- Ø³ÙŠØªÙ… Ù…Ù„Ø¤Ù‡Ø§ Ø¨Ø§Ù„Ø¬Ø§ÙØ§ Ø³ÙƒØ±ÙŠØ¨Øª -->
                        </div>
                    </div>

                    <!-- Ù‚Ø³Ù… Ø§Ù„Ø³Ù„Ø© -->
                    <div class="cart-section">
                        <div class="cart-header">
                            <h3>
                                <i class="fas fa-shopping-cart"></i>
                                Ø§Ù„Ø³Ù„Ø©
                            </h3>
                        </div>

                        <div class="cart-items" id="cartItems">
                            <p style="text-align: center; color: var(--text-secondary); padding: 20px;">
                                Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©
                            </p>
                        </div>

                        <div class="cart-total">
                            <div class="total-row">
                                <span>Ø§Ù„Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„ÙØ±Ø¹ÙŠ:</span>
                                <span id="cartSubtotal">0 Ø¯.Ø¹</span>
                            </div>
                            <div class="total-row final">
                                <span>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</span>
                                <span id="cartTotal">0 Ø¯.Ø¹</span>
                            </div>
                        </div>

                        <div class="cart-actions">
                            <button class="btn btn-warning btn-sm" onclick="suspendOrder()">
                                <i class="fas fa-pause"></i>
                                ØªØ¹Ù„ÙŠÙ‚
                            </button>
                            <button class="btn btn-danger btn-sm" onclick="clearCart()">
                                <i class="fas fa-times"></i>
                                Ù…Ø³Ø­
                            </button>
                            <button class="btn btn-info btn-sm" onclick="showSuspendedOrders()">
                                <i class="fas fa-list"></i>
                                Ø§Ù„Ù…Ø¹Ù„Ù‚
                            </button>
                            <button class="btn btn-success btn-sm" onclick="completeSale()">
                                <i class="fas fa-check"></i>
                                Ø¥ØªÙ…Ø§Ù…
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
            <div class="page" id="productsPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-boxes"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="showAddProductModal()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬
                        </button>
                        <button class="btn btn-info" onclick="showAddCategoryModal()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ
                        </button>
                        <button class="btn btn-success" onclick="exportToExcel('products')">
                            <i class="fas fa-file-excel"></i>
                            Excel
                        </button>
                        <button class="btn btn-warning" onclick="exportToPDF('products')">
                            <i class="fas fa-file-pdf"></i>
                            PDF
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('homePage')">
                            <i class="fas fa-arrow-right"></i>
                            Ø¹ÙˆØ¯Ø©
                        </button>
                    </div>
                </div>

                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª</h3>
                            <div class="stat-value" id="totalProducts">0</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-dollar-sign"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø³Ø¹Ø±</h3>
                            <div class="stat-value" id="avgPrice">0 Ø¯.Ø¹</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-coins"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„ØªÙƒÙ„ÙØ©</h3>
                            <div class="stat-value" id="avgCost">0 Ø¯.Ø¹</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø¨Ø­</h3>
                            <div class="stat-value" id="avgProfit">0 Ø¯.Ø¹</div>
                        </div>
                    </div>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label>Ø§Ù„Ø¨Ø­Ø«</label>
                        <input type="text" class="form-control" id="searchProducts" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…Ù†ØªØ¬..." onkeyup="loadProducts()">
                    </div>
                    <div class="filter-group">
                        <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                        <select class="form-control" id="filterCategory" onchange="loadProducts()">
                            <option value="">Ø§Ù„ÙƒÙ„</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body" id="productsTableContainer">
                        <p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª -->
            <div class="page" id="categoriesPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-th-large"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="showAddCategoryModal()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('homePage')">
                            <i class="fas fa-arrow-right"></i>
                            Ø¹ÙˆØ¯Ø©
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body" id="categoriesTableContainer">
                        <p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØµÙ†ÙŠÙØ§Øª</p>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
            <div class="page" id="invoicesPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-file-invoice-dollar"></i>
                        Ø§Ù„ÙÙˆØ§ØªÙŠØ±
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-success" onclick="exportToExcel('invoices')">
                            <i class="fas fa-file-excel"></i>
                            Excel
                        </button>
                        <button class="btn btn-warning" onclick="exportToPDF('invoices')">
                            <i class="fas fa-file-pdf"></i>
                            PDF
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('homePage')">
                            <i class="fas fa-arrow-right"></i>
                            Ø¹ÙˆØ¯Ø©
                        </button>
                    </div>
                </div>

                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„ÙÙˆØ§ØªÙŠØ± -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-file-invoice"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¹Ø¯Ø¯ Ø§Ù„ÙÙˆØ§ØªÙŠØ±</h3>
                            <div class="stat-value" id="totalInvoices">0</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                            <div class="stat-value" id="totalSales">0 Ø¯.Ø¹</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-chart-line"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±Ø¨Ø­</h3>
                            <div class="stat-value" id="totalProfitInvoices">0 Ø¯.Ø¹</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-percentage"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ù‡Ø§Ù…Ø´ Ø§Ù„Ø±Ø¨Ø­</h3>
                            <div class="stat-value" id="profitMargin">0%</div>
                        </div>
                    </div>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" class="form-control" id="invoicesDateFrom">
                    </div>
                    <div class="filter-group">
                        <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" class="form-control" id="invoicesDateTo">
                    </div>
                    <div class="filter-group">
                        <button class="btn btn-info" onclick="loadInvoices()">
                            <i class="fas fa-filter"></i>
                            ÙÙ„ØªØ±Ø©
                        </button>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body" id="invoicesTableContainer">
                        <p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ±</p>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ -->
            <div class="page" id="expensesPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-receipt"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="showAddExpenseModal()">
                            <i class="fas fa-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ
                        </button>
                        <button class="btn btn-success" onclick="exportToExcel('expenses')">
                            <i class="fas fa-file-excel"></i>
                            Excel
                        </button>
                        <button class="btn btn-warning" onclick="exportToPDF('expenses')">
                            <i class="fas fa-file-pdf"></i>
                            PDF
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('homePage')">
                            <i class="fas fa-arrow-right"></i>
                            Ø¹ÙˆØ¯Ø©
                        </button>
                    </div>
                </div>

                <!-- Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ -->
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-receipt"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h3>
                            <div class="stat-value" id="totalExpensesCount">0</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ</h3>
                            <div class="stat-value" id="totalExpensesAmount">0 Ø¯.Ø¹</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-check-circle"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø§Ù„Ù…Ø¯ÙÙˆØ¹</h3>
                            <div class="stat-value" id="paidExpenses">0 Ø¯.Ø¹</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</h3>
                            <div class="stat-value" id="remainingExpenses">0 Ø¯.Ø¹</div>
                        </div>
                    </div>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label>Ø§Ù„Ø¨Ø­Ø«</label>
                        <input type="text" class="form-control" id="searchExpenses" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ØµØ±ÙˆÙ..." onkeyup="loadExpenses()">
                    </div>
                    <div class="filter-group">
                        <label>Ù…Ù† ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" class="form-control" id="expensesDateFrom" onchange="loadExpenses()">
                    </div>
                    <div class="filter-group">
                        <label>Ø¥Ù„Ù‰ ØªØ§Ø±ÙŠØ®</label>
                        <input type="date" class="form-control" id="expensesDateTo" onchange="loadExpenses()">
                    </div>
                </div>

                <div class="card">
                    <div class="card-body" id="expensesTableContainer">
                        <p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ</p>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± -->
            <div class="page" id="reportsPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-chart-line"></i>
                        Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
                    </h2>
                    <button class="btn btn-secondary" onclick="showPage('homePage')">
                        <i class="fas fa-arrow-right"></i>
                        Ø¹ÙˆØ¯Ø©
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-chart-bar"></i> Ù†Ø¸Ø±Ø© Ø¹Ø§Ù…Ø©</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="salesChart" style="max-height: 400px;"></canvas>
                    </div>
                </div>

                <div class="card mt-20">
                    <div class="card-header">
                        <h3><i class="fas fa-pie-chart"></i> ØªÙˆØ²ÙŠØ¹ Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª</h3>
                    </div>
                    <div class="card-body">
                        <canvas id="profitChart" style="max-height: 400px;"></canvas>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
            <div class="page" id="settingsPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-cog"></i>
                        Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                    </h2>
                    <button class="btn btn-secondary" onclick="showPage('homePage')">
                        <i class="fas fa-arrow-right"></i>
                        Ø¹ÙˆØ¯Ø©
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-palette"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø«ÙŠÙ…</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Ø§Ø®ØªØ± Ø§Ù„Ø«ÙŠÙ…</label>
                            <select class="form-control" id="themeSelect" onchange="changeThemeFromSelect()">
                                <option value="light-theme">ÙØ§ØªØ­ (ÙƒØ±ÙŠÙ…)</option>
                                <option value="dark-theme">Ø¯Ø§ÙƒÙ† (Ø°Ù‡Ø¨ÙŠ)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <div class="card mt-20">
                    <div class="card-header">
                        <h3><i class="fas fa-print"></i> Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©</h3>
                    </div>
                    <div class="card-body">
                        <div class="form-group">
                            <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…</label>
                            <input type="text" class="form-control" id="restaurantName" placeholder="Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                            <input type="text" class="form-control" id="restaurantAddress" placeholder="Ø§Ù„Ø¹Ù†ÙˆØ§Ù†">
                        </div>
                        <div class="form-group">
                            <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                            <input type="text" class="form-control" id="restaurantPhone" placeholder="Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ">
                        </div>
                        <div class="form-group">
                            <label>Ø§Ù„Ù„ÙˆØ¬Ùˆ</label>
                            <input type="file" class="form-control" id="restaurantLogo" accept="image/*" onchange="uploadLogo(event)">
                            <img id="logoPreview" class="image-preview hidden" alt="Logo">
                        </div>
                        <button class="btn btn-primary" onclick="saveSettings()">
                            <i class="fas fa-save"></i>
                            Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                        </button>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ -->
            <div class="page" id="backupPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-database"></i>
                        Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                    </h2>
                    <button class="btn btn-secondary" onclick="showPage('homePage')">
                        <i class="fas fa-arrow-right"></i>
                        Ø¹ÙˆØ¯Ø©
                    </button>
                </div>

                <div class="card">
                    <div class="card-header">
                        <h3><i class="fas fa-download"></i> ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    </div>
                    <div class="card-body">
                        <p style="margin-bottom: 15px; color: var(--text-secondary);">
                            Ù‚Ù… Ø¨ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù…Ø§ ÙÙŠ Ø°Ù„Ùƒ Ø§Ù„Ù…Ù†ØªØ¬Ø§ØªØŒ Ø§Ù„ØªØµÙ†ÙŠÙØ§ØªØŒ Ø§Ù„ÙÙˆØ§ØªÙŠØ±ØŒ Ø§Ù„Ù…ØµØ§Ø±ÙŠÙØŒ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†ØŒ ÙˆØ§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                        </p>
                        <button class="btn btn-primary" onclick="exportData()">
                            <i class="fas fa-file-export"></i>
                            ØªØµØ¯ÙŠØ± Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </div>

                <div class="card mt-20">
                    <div class="card-header">
                        <h3><i class="fas fa-upload"></i> Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</h3>
                    </div>
                    <div class="card-body">
                        <p style="margin-bottom: 15px; color: var(--text-secondary);">
                            Ø§Ø³ØªØ±Ø¬Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ù†Ø³Ø®Ø© Ø§Ø­ØªÙŠØ§Ø·ÙŠØ© Ø³Ø§Ø¨Ù‚Ø©
                        </p>
                        <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importData(event)">
                        <button class="btn btn-warning" onclick="document.getElementById('importFile').click()">
                            <i class="fas fa-file-import"></i>
                            Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                    </div>
                </div>

                <div class="card mt-20">
                    <div class="card-header">
                        <h3><i class="fas fa-cloud"></i> Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ (Firebase)</h3>
                    </div>
                    <div class="card-body">
                        <div id="cloudStatus" style="margin-bottom: 15px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                            <p style="margin-bottom: 10px; color: var(--text-secondary);">
                                Ø­Ø§Ù„Ø© Ø§Ù„Ø§ØªØµØ§Ù„: <span id="cloudConnectionStatus" style="font-weight: 700; color: var(--danger-color);">ØºÙŠØ± Ù…ØªØµÙ„</span>
                            </p>
                            <p style="margin-bottom: 0; color: var(--text-secondary);">
                                Ø¢Ø®Ø± Ù…Ø²Ø§Ù…Ù†Ø©: <span id="lastSyncTime" style="font-weight: 700;">Ù„Ù… ÙŠØªÙ…</span>
                            </p>
                        </div>
                        <button class="btn btn-info" onclick="showCloudSubscriptionModal()" id="cloudSubscribeBtn">
                            <i class="fas fa-cloud-upload-alt"></i>
                            Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ
                        </button>
                        <button class="btn btn-success hidden" onclick="syncToCloud()" id="cloudSyncBtn">
                            <i class="fas fa-sync"></i>
                            Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                        </button>
                        <button class="btn btn-danger hidden" onclick="disconnectCloud()" id="cloudDisconnectBtn">
                            <i class="fas fa-unlink"></i>
                            Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„
                        </button>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† -->
            <div class="page" id="usersPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-users-cog"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="showAddUserModal()">
                            <i class="fas fa-user-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('homePage')">
                            <i class="fas fa-arrow-right"></i>
                            Ø¹ÙˆØ¯Ø©
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</h3>
                            <div class="stat-value" id="totalUsers">0</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-shield"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø§Ù„Ù…Ø¯Ø±Ø§Ø¡</h3>
                            <div class="stat-value" id="totalAdmins">1</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-user-check"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ù†Ø´Ø·ÙŠÙ†</h3>
                            <div class="stat-value" id="activeUsers">0</div>
                        </div>
                    </div>
                </div>

                <div class="card">
                    <div class="card-body" id="usersTableContainer">
                        <p style="text-align: center; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>
                    </div>
                </div>
            </div>

            <!-- ØµÙØ­Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ† -->
            <div class="page" id="employeesPage">
                <div class="page-header">
                    <h2>
                        <i class="fas fa-user-tie"></i>
                        Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
                    </h2>
                    <div style="display: flex; gap: 10px;">
                        <button class="btn btn-primary" onclick="showAddEmployeeModal()">
                            <i class="fas fa-user-plus"></i>
                            Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù
                        </button>
                        <button class="btn btn-success" onclick="exportToExcel('employees')">
                            <i class="fas fa-file-excel"></i>
                            Excel
                        </button>
                        <button class="btn btn-warning" onclick="exportToPDF('employees')">
                            <i class="fas fa-file-pdf"></i>
                            PDF
                        </button>
                        <button class="btn btn-secondary" onclick="showPage('homePage')">
                            <i class="fas fa-arrow-right"></i>
                            Ø¹ÙˆØ¯Ø©
                        </button>
                    </div>
                </div>

                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¹Ø¯Ø¯ Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†</h3>
                            <div class="stat-value" id="totalEmployees">0</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„Ø±ÙˆØ§ØªØ¨</h3>
                            <div class="stat-value" id="totalSalaries">0 Ø¯.Ø¹</div>
                        </div>
                    </div>

                    <div class="stat-card">
                        <div class="stat-icon">
                            <i class="fas fa-calculator"></i>
                        </div>
                        <div class="stat-info">
                            <h3>Ù…ØªÙˆØ³Ø· Ø§Ù„Ø±Ø§ØªØ¨</h3>
                            <div class="stat-value" id="avgSalary">0 Ø¯.Ø¹</div>
                        </div>
                    </div>
                </div>

                <div class="filters">
                    <div class="filter-group">
                        <label>Ø§Ù„Ø¨Ø­Ø«</label>
                        <input type="text" class="form-control" id="searchEmployees" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ù…ÙˆØ¸Ù..." onkeyup="loadEmployees()">
                    </div>
                </div>

                <div class="card">
                    <div class="card-body" id="employeesTableContainer">
                        <p style="text-align: center; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</p>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="productModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯</h3>
                <span class="close" onclick="closeModal('productModal')">&times;</span>
            </div>
            <form onsubmit="saveProduct(event)">
                <input type="hidden" id="productId">
                <div class="form-group">
                    <label>ØµÙˆØ±Ø© Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <input type="file" class="form-control" id="productImage" accept="image/*" onchange="previewImage(event, 'productImagePreview')">
                    <img id="productImagePreview" class="image-preview hidden" alt="Product">
                </div>
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù†ØªØ¬</label>
                    <input type="text" class="form-control" id="productName" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                    <select class="form-control" id="productCategory" required>
                        <option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø³Ø¹Ø± Ø§Ù„ØªÙƒÙ„ÙŠÙÙŠ</label>
                    <input type="number" class="form-control" id="productCost" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ø³Ø¹Ø± Ø§Ù„Ø¨ÙŠØ¹</label>
                    <input type="number" class="form-control" id="productPrice" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙˆØµÙ</label>
                    <textarea class="form-control" id="productDescription" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i>
                    Ø­ÙØ¸
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ -->
    <div id="categoryModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="categoryModalTitle">Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯</h3>
                <span class="close" onclick="closeModal('categoryModal')">&times;</span>
            </div>
            <form onsubmit="saveCategory(event)">
                <input type="hidden" id="categoryId">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„ØªØµÙ†ÙŠÙ</label>
                    <input type="text" class="form-control" id="categoryName" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙˆØµÙ</label>
                    <textarea class="form-control" id="categoryDescription" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i>
                    Ø­ÙØ¸
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ -->
    <div id="expenseModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="expenseModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯</h3>
                <span class="close" onclick="closeModal('expenseModal')">&times;</span>
            </div>
            <form onsubmit="saveExpense(event)">
                <input type="hidden" id="expenseId">
                <div class="form-group">
                    <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…ØµØ±ÙˆÙ</label>
                    <input type="text" class="form-control" id="expenseTitle" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</label>
                    <input type="number" class="form-control" id="expenseAmount" required min="0" step="0.01">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹</label>
                    <input type="number" class="form-control" id="expensePaid" min="0" step="0.01" value="0">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ØªØ§Ø±ÙŠØ®</label>
                    <input type="date" class="form-control" id="expenseDate" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„ÙˆØµÙ</label>
                    <textarea class="form-control" id="expenseDescription" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i>
                    Ø­ÙØ¸
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø© -->
    <div id="addToCartModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="addToCartTitle">Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©</h3>
                <span class="close" onclick="closeModal('addToCartModal')">&times;</span>
            </div>
            <div style="text-align: center; margin-bottom: 20px;">
                <img id="cartProductImage" class="image-preview" style="max-height: 150px;" alt="Product">
                <h4 id="cartProductName" style="margin: 10px 0; color: var(--text-primary);"></h4>
                <p id="cartProductPrice" style="font-size: 18px; font-weight: 700; color: var(--primary-color);"></p>
            </div>
            <div class="form-group">
                <label>Ø§Ù„ÙƒÙ…ÙŠØ©</label>
                <input type="number" class="form-control" id="cartQuantity" min="1" value="1" required>
            </div>
            <button class="btn btn-primary btn-block" onclick="confirmAddToCart()">
                <i class="fas fa-cart-plus"></i>
                Ø¥Ø¶Ø§ÙØ©
            </button>
        </div>
    </div>

    <!-- Modal Ø¹Ø±Ø¶ Ø§Ù„ØªÙØ§ØµÙŠÙ„ -->
    <div id="detailsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="detailsModalTitle">Ø§Ù„ØªÙØ§ØµÙŠÙ„</h3>
                <span class="close" onclick="closeModal('detailsModal')">&times;</span>
            </div>
            <div id="detailsContent"></div>
        </div>
    </div>

    <!-- Modal Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø© -->
    <div id="suspendedOrdersModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø§Ù„Ø·Ù„Ø¨Ø§Øª Ø§Ù„Ù…Ø¹Ù„Ù‚Ø©</h3>
                <span class="close" onclick="closeModal('suspendedOrdersModal')">&times;</span>
            </div>
            <div id="suspendedOrdersList"></div>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="userModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯</h3>
                <span class="close" onclick="closeModal('userModal')">&times;</span>
            </div>
            <form onsubmit="saveUser(event)">
                <input type="hidden" id="userId">
                <div class="form-group">
                    <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                    <input type="text" class="form-control" id="userName" required>
                </div>
                <div class="form-group">
                    <label>ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ±</label>
                    <input type="password" class="form-control" id="userPassword" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" class="form-control" id="userFullName" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</label>
                    <input type="email" class="form-control" id="userEmail">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¯ÙˆØ±</label>
                    <select class="form-control" id="userRole" required>
                        <option value="user">Ù…Ø³ØªØ®Ø¯Ù…</option>
                        <option value="admin">Ù…Ø¯ÙŠØ±</option>
                    </select>
                </div>
                <div class="card mt-20">
                    <div class="card-header">
                        <h3 style="font-size: 16px;"><i class="fas fa-key"></i> Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª</h3>
                    </div>
                    <div class="card-body">
                        <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 15px;">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="products_add"> Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="products_edit"> ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬Ø§Øª
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="products_delete"> Ø­Ø°Ù Ù…Ù†ØªØ¬Ø§Øª
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="products_view"> Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="expenses_add"> Ø¥Ø¶Ø§ÙØ© Ù…ØµØ§Ø±ÙŠÙ
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="expenses_edit"> ØªØ¹Ø¯ÙŠÙ„ Ù…ØµØ§Ø±ÙŠÙ
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="expenses_delete"> Ø­Ø°Ù Ù…ØµØ§Ø±ÙŠÙ
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="expenses_view"> Ø¹Ø±Ø¶ Ù…ØµØ§Ø±ÙŠÙ
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="invoices_view"> Ø¹Ø±Ø¶ ÙÙˆØ§ØªÙŠØ±
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="invoices_delete"> Ø­Ø°Ù ÙÙˆØ§ØªÙŠØ±
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="pos_access"> Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="settings_access"> Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="reports_view"> Ø¹Ø±Ø¶ Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±
                            </label>
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" class="permission-check" value="backup_access"> Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
                            </label>
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn btn-primary btn-block" style="margin-top: 20px;">
                    <i class="fas fa-save"></i>
                    Ø­ÙØ¸
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù -->
    <div id="employeeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="employeeModalTitle">Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯</h3>
                <span class="close" onclick="closeModal('employeeModal')">&times;</span>
            </div>
            <form onsubmit="saveEmployee(event)">
                <input type="hidden" id="employeeId">
                <div class="form-group">
                    <label>ØµÙˆØ±Ø© Ø§Ù„Ù…ÙˆØ¸Ù</label>
                    <input type="file" class="form-control" id="employeeImage" accept="image/*" onchange="previewImage(event, 'employeeImagePreview')">
                    <img id="employeeImagePreview" class="image-preview hidden" alt="Employee">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</label>
                    <input type="text" class="form-control" id="employeeName" required>
                </div>
                <div class="form-group">
                    <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                    <input type="tel" class="form-control" id="employeePhone" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                    <input type="text" class="form-control" id="employeeAddress">
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ</label>
                    <input type="number" class="form-control" id="employeeSalary" required min="0" step="1000">
                </div>
                <div class="form-group">
                    <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</label>
                    <input type="date" class="form-control" id="employeeHireDate" required>
                </div>
                <div class="form-group">
                    <label>Ø§Ù„Ù…Ù†ØµØ¨</label>
                    <input type="text" class="form-control" id="employeePosition" placeholder="Ù…Ø«Ø§Ù„: Ù†Ø§Ø¯Ù„ØŒ Ø·Ø¨Ø§Ø®ØŒ ÙƒØ§Ø´ÙŠØ±">
                </div>
                <div class="form-group">
                    <label>Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
                    <textarea class="form-control" id="employeeNotes" rows="3"></textarea>
                </div>
                <button type="submit" class="btn btn-primary btn-block">
                    <i class="fas fa-save"></i>
                    Ø­ÙØ¸
                </button>
            </form>
        </div>
    </div>

    <!-- Modal Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ -->
    <div id="cloudSubscriptionModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ</h3>
                <span class="close" onclick="closeModal('cloudSubscriptionModal')">&times;</span>
            </div>
            <div id="subscriptionStep1">
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    Ø§Ù…Ù„Ø£ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ§Ù„ÙŠØ© Ù„Ù„Ø§Ø´ØªØ±Ø§Ùƒ ÙÙŠ Ø®Ø¯Ù…Ø© Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ
                </p>
                <form onsubmit="submitSubscription(event)">
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</label>
                        <input type="text" class="form-control" id="cloudUsername" required>
                    </div>
                    <div class="form-group">
                        <label>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</label>
                        <input type="tel" class="form-control" id="cloudPhone" required>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…</label>
                        <input type="text" class="form-control" id="cloudRestaurantName" required>
                    </div>
                    <div class="form-group">
                        <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</label>
                        <input type="text" class="form-control" id="cloudAddress" required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="fas fa-arrow-right"></i>
                        Ø§Ù„ØªØ§Ù„ÙŠ
                    </button>
                </form>
            </div>
            <div id="subscriptionStep2" class="hidden">
                <p style="margin-bottom: 20px; color: var(--text-secondary);">
                    Ø³ÙŠØªÙ… Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ø´ØªØ±Ø§Ùƒ ÙØ±ÙŠØ¯ Ù„Ùƒ. Ø§Ø­ØªÙØ¸ Ø¨Ù‡ ÙÙŠ Ù…ÙƒØ§Ù† Ø¢Ù…Ù†.
                </p>
                <div style="background: var(--bg-tertiary); padding: 20px; border-radius: 12px; text-align: center; margin-bottom: 20px;">
                    <h4 style="margin-bottom: 10px; color: var(--text-primary);">ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ</h4>
                    <p id="subscriptionCode" style="font-size: 24px; font-weight: 700; color: var(--primary-color); letter-spacing: 2px; font-family: monospace;"></p>
                    <button class="btn btn-sm btn-info" onclick="copySubscriptionCode()">
                        <i class="fas fa-copy"></i>
                        Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
                    </button>
                </div>
                <button class="btn btn-success btn-block" onclick="activateCloudSubscription()">
                    <i class="fas fa-check"></i>
                    ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                </button>
            </div>
        </div>
    </div>

    <script>
        // ØªÙ‡ÙŠØ¦Ø© Firebase
        const firebaseConfig = {
            apiKey: "AIzaSyDGpAHia_wEmrhnmYjrPf1n1TrAzwEMiAI",
            authDomain: "messageemeapp.firebaseapp.com",
            databaseURL: "https://messageemeapp-default-rtdb.firebaseio.com",
            projectId: "messageemeapp",
            storageBucket: "messageemeapp.appspot.com",
            messagingSenderId: "255034474844",
            appId: "1:255034474844:web:5e3b7a6bc4b2fb94cc4199",
            measurementId: "G-4QBEWRC583"
        };

        // ØªÙ‡ÙŠØ¦Ø© Firebase
        let firebaseApp = null;
        let firebaseDB = null;
        let currentUserId = null;

        try {
            firebaseApp = firebase.initializeApp(firebaseConfig);
            firebaseDB = firebase.database();
            console.log('Firebase initialized successfully');
        } catch (error) {
            console.log('Firebase initialization:', error.message);
        }

        // Ø«ÙˆØ§Ø¨Øª Ø§Ù„Ù†Ø¸Ø§Ù…
        const COMPANY_WHATSAPP = '9647813798636'; // Ø±Ù‚Ù… Ø§Ù„Ø´Ø±ÙƒØ©
        const TRIAL_DAYS = 7;
        const YEARLY_SUBSCRIPTION_DAYS = 365;
        const SUBSCRIPTION_PRICE = 100; // Ø¯ÙˆÙ„Ø§Ø±

        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ®Ø²ÙŠÙ† Ø§Ù„Ù…Ø­Ù„ÙŠ
        const LocalDB = {
            KEYS: {
                PRODUCTS: 'restaurant_products',
                CATEGORIES: 'restaurant_categories',
                INVOICES: 'restaurant_invoices',
                EXPENSES: 'restaurant_expenses',
                EMPLOYEES: 'restaurant_employees',
                USERS: 'restaurant_users',
                SETTINGS: 'restaurant_settings',
                THEME: 'restaurant_theme',
                CART: 'restaurant_cart',
                SUSPENDED_ORDERS: 'restaurant_suspended_orders',
                CURRENT_USER: 'restaurant_current_user',
                CLOUD_CONFIG: 'restaurant_cloud_config',
                SUBSCRIPTION_CODE: 'restaurant_subscription_code',
                APP_REGISTRATION: 'restaurant_app_registration',
                ACTIVATION_DATA: 'restaurant_activation_data'
            },

            save(key, data) {
                try {
                    localStorage.setItem(key, JSON.stringify(data));
                    return true;
                } catch (error) {
                    console.error('Error saving:', error);
                    return false;
                }
            },

            get(key) {
                try {
                    const data = localStorage.getItem(key);
                    return data ? JSON.parse(data) : null;
                } catch (error) {
                    console.error('Error reading:', error);
                    return null;
                }
            }
        };

        // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
        let currentCart = [];
        let selectedProduct = null;
        let currentUser = null;
        let userPermissions = [];

        // ==================== Ù†Ø¸Ø§Ù… Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ§Ù„ØªÙØ¹ÙŠÙ„ ====================
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ù†Ø¯ Ø¨Ø¯Ø¡ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function checkAppRegistration() {
            const registration = LocalDB.get(LocalDB.KEYS.APP_REGISTRATION);
            
            if (!registration) {
                // ØªØ·Ø¨ÙŠÙ‚ Ø¬Ø¯ÙŠØ¯ - Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„
                showRegistrationScreen();
                return false;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
            return checkSubscriptionStatus(registration);
        }

        function showRegistrationScreen() {
            document.getElementById('registrationScreen').classList.remove('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        // Ø­ÙØ¸ Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
        function submitInitialRegistration(event) {
            event.preventDefault();

            const registrationData = {
                restaurantName: document.getElementById('regRestaurantName').value,
                ownerName: document.getElementById('regOwnerName').value,
                phone: document.getElementById('regPhone').value,
                address: document.getElementById('regAddress').value,
                registrationDate: new Date().toISOString(),
                trialStartDate: new Date().toISOString(),
                trialEndDate: new Date(Date.now() + TRIAL_DAYS * 24 * 60 * 60 * 1000).toISOString(),
                status: 'trial', // trial, active, expired
                machineId: generateMachineId(),
                activationCode: null
            };

            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø­Ù„ÙŠØ§Ù‹
            LocalDB.save(LocalDB.KEYS.APP_REGISTRATION, registrationData);

            // Ø¥Ø±Ø³Ø§Ù„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¹Ø¨Ø± WhatsApp
            sendRegistrationToWhatsApp(registrationData);

            // Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¥Ù„Ù‰ Firebase
            if (firebaseDB) {
                const appRef = firebaseDB.ref('registrations/' + registrationData.machineId);
                appRef.set({
                    ...registrationData,
                    needsActivation: true
                }).catch(err => console.error('Firebase save error:', err));
            }

            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø§Ø´Ø© Ø§Ù„ØªØ³Ø¬ÙŠÙ„ ÙˆØ¥Ø¸Ù‡Ø§Ø± ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
            document.getElementById('registrationScreen').classList.add('hidden');
            document.getElementById('loginScreen').classList.remove('hidden');
            
            showNotification(`Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ! Ù„Ø¯ÙŠÙƒ ${TRIAL_DAYS} Ø£ÙŠØ§Ù… ÙØªØ±Ø© ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ù…Ø¬Ø§Ù†ÙŠØ©`, 'success');
        }

        // ØªÙˆÙ„ÙŠØ¯ Ù…Ø¹Ø±Ù ÙØ±ÙŠØ¯ Ù„Ù„Ø¬Ù‡Ø§Ø²
        function generateMachineId() {
            let machineId = LocalDB.get('machine_id');
            if (!machineId) {
                machineId = 'MACHINE_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9).toUpperCase();
                LocalDB.save('machine_id', machineId);
            }
            return machineId;
        }

        // Ø¥Ø±Ø³Ø§Ù„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø¹Ø¨Ø± WhatsApp
        function sendRegistrationToWhatsApp(data) {
            const message = `
ğŸ†• *ØªØ³Ø¬ÙŠÙ„ Ø¬Ø¯ÙŠØ¯ - Ù†Ø¸Ø§Ù… Cash Pro*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸª *Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…:* ${data.restaurantName}
ğŸ‘¤ *Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ:* ${data.ownerName}
ğŸ“± *Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:* ${data.phone}
ğŸ“ *Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:* ${data.address}
ğŸ–¥ï¸ *Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø²:* ${data.machineId}
ğŸ“… *ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ³Ø¬ÙŠÙ„:* ${formatDate(data.registrationDate)}
â° *Ù†Ù‡Ø§ÙŠØ© Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©:* ${formatDate(data.trialEndDate)}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ *ÙŠØ±Ø¬Ù‰ Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ ØªÙØ¹ÙŠÙ„ Ù„Ù„Ø¹Ù…ÙŠÙ„*
            `.trim();

            const whatsappUrl = `https://wa.me/${COMPANY_WHATSAPP}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø­Ø§Ù„Ø© Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        function checkSubscriptionStatus(registration) {
            const now = new Date();
            const trialEnd = new Date(registration.trialEndDate);

            if (registration.status === 'active' && registration.activationCode) {
                // Ø§Ø´ØªØ±Ø§Ùƒ Ù†Ø´Ø· - Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØªØ§Ø±ÙŠØ® Ø§Ù„Ø§Ù†ØªÙ‡Ø§Ø¡
                if (registration.subscriptionEndDate) {
                    const subEnd = new Date(registration.subscriptionEndDate);
                    if (now > subEnd) {
                        // Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ - Ø·Ù„Ø¨ Ø§Ù„ØªØ¬Ø¯ÙŠØ¯
                        showRenewalScreen();
                        return false;
                    }
                }
                return true; // Ø§Ø´ØªØ±Ø§Ùƒ Ù†Ø´Ø·
            }

            if (registration.status === 'trial') {
                if (now > trialEnd) {
                    // Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                    showTrialExpiredScreen();
                    return false;
                }
                // Ù„Ø§ Ø²Ø§Ù„ ÙÙŠ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
                const daysLeft = Math.ceil((trialEnd - now) / (24 * 60 * 60 * 1000));
                console.log(`Ø£ÙŠØ§Ù… Ù…ØªØ¨Ù‚ÙŠØ© Ù…Ù† Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©: ${daysLeft}`);
                return true;
            }

            // Ø­Ø§Ù„Ø© ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØ©
            showTrialExpiredScreen();
            return false;
        }

        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©
        function showTrialExpiredScreen() {
            const registration = LocalDB.get(LocalDB.KEYS.APP_REGISTRATION);
            
            document.getElementById('expiredTitle').textContent = 'Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ©';
            document.getElementById('trialExpiredMessage').innerHTML = `
                Ø¹Ø²ÙŠØ²ÙŠ <strong>${registration.ownerName}</strong>ØŒ<br>
                Ù„Ù‚Ø¯ Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø© Ø§Ù„ØªØ¬Ø±ÙŠØ¨ÙŠØ© Ø§Ù„Ø¨Ø§Ù„ØºØ© ${TRIAL_DAYS} Ø£ÙŠØ§Ù… Ù„Ù…Ø·Ø¹Ù… <strong>${registration.restaurantName}</strong>.
            `;
            
            document.getElementById('trialExpiredScreen').classList.remove('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        // Ø¹Ø±Ø¶ Ø´Ø§Ø´Ø© ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
        function showRenewalScreen() {
            const registration = LocalDB.get(LocalDB.KEYS.APP_REGISTRATION);
            
            document.getElementById('expiredTitle').textContent = 'Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ù†ÙˆÙŠ';
            document.getElementById('trialExpiredMessage').innerHTML = `
                Ø¹Ø²ÙŠØ²ÙŠ <strong>${registration.ownerName}</strong>ØŒ<br>
                Ù„Ù‚Ø¯ Ø§Ù†ØªÙ‡Ù‰ Ø§Ø´ØªØ±Ø§ÙƒÙƒ Ø§Ù„Ø³Ù†ÙˆÙŠ Ù„Ù…Ø·Ø¹Ù… <strong>${registration.restaurantName}</strong>.<br>
                Ù„ØªØ¬Ø¯ÙŠØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§ÙƒØŒ ÙŠØ±Ø¬Ù‰ Ø¯ÙØ¹ <strong>${SUBSCRIPTION_PRICE} Ø¯ÙˆÙ„Ø§Ø±</strong> ÙˆØ§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² ØªÙØ¹ÙŠÙ„ Ø¬Ø¯ÙŠØ¯.
            `;
            
            document.getElementById('trialExpiredScreen').classList.remove('hidden');
            document.getElementById('loginScreen').classList.add('hidden');
            document.getElementById('dashboard').classList.add('hidden');
        }

        // Ø§Ù„ØªÙˆØ§ØµÙ„ Ù…Ø¹ Ø§Ù„Ø´Ø±ÙƒØ© Ø¹Ø¨Ø± WhatsApp Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ ÙƒÙˆØ¯ Ø§Ù„ØªÙØ¹ÙŠÙ„
        function contactCompanyForActivation() {
            const registration = LocalDB.get(LocalDB.KEYS.APP_REGISTRATION);
            
            const message = `
ğŸ”‘ *Ø·Ù„Ø¨ ØªÙØ¹ÙŠÙ„ - Ù†Ø¸Ø§Ù… Cash Pro*
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
ğŸª *Ø§Ø³Ù… Ø§Ù„Ù…Ø·Ø¹Ù…:* ${registration.restaurantName}
ğŸ‘¤ *Ø§Ø³Ù… Ø§Ù„Ù…Ø§Ù„Ùƒ:* ${registration.ownerName}
ğŸ“± *Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:* ${registration.phone}
ğŸ–¥ï¸ *Ù…Ø¹Ø±Ù Ø§Ù„Ø¬Ù‡Ø§Ø²:* ${registration.machineId}
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
âš ï¸ *Ø£Ø±ØºØ¨ ÙÙŠ Ø§Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„*
            `.trim();

            const whatsappUrl = `https://wa.me/${COMPANY_WHATSAPP}?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
            return false;
        }

        // ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ø§Ù„ÙƒÙˆØ¯
        function activateWithCode(event) {
            event.preventDefault();
            
            const code = document.getElementById('activationCode').value.trim().toUpperCase();
            const registration = LocalDB.get(LocalDB.KEYS.APP_REGISTRATION);

            if (!code) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„', 'error');
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯ ÙÙŠ Firebase
            if (firebaseDB) {
                const activationRef = firebaseDB.ref('activations/' + registration.machineId);
                activationRef.once('value').then(snapshot => {
                    const activationData = snapshot.val();
                    
                    if (activationData && activationData.code === code && activationData.valid) {
                        // ÙƒÙˆØ¯ ØµØ­ÙŠØ­ - ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ
                        registration.status = 'active';
                        registration.activationCode = code;
                        registration.activationDate = new Date().toISOString();
                        registration.subscriptionEndDate = new Date(Date.now() + YEARLY_SUBSCRIPTION_DAYS * 24 * 60 * 60 * 1000).toISOString();
                        
                        LocalDB.save(LocalDB.KEYS.APP_REGISTRATION, registration);
                        
                        // ØªØ­Ø¯ÙŠØ« Ø­Ø§Ù„Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙÙŠ Firebase
                        activationRef.update({ used: true, usedAt: new Date().toISOString() });
                        
                        document.getElementById('trialExpiredScreen').classList.add('hidden');
                        document.getElementById('loginScreen').classList.remove('hidden');
                        
                        showNotification('ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­! Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ', 'success');
                    } else {
                        showNotification('Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                    }
                }).catch(err => {
                    console.error('Activation check error:', err);
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„', 'error');
                });
            } else {
                showNotification('Ù„Ø§ ÙŠÙ…ÙƒÙ† Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø±Ù…Ø² Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ø¯ÙˆÙ† Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø¥Ù†ØªØ±Ù†Øª', 'error');
            }
        }

        // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø³Ø­Ø§Ø¨Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„ÙƒÙˆØ¯
        function reconnectWithCode() {
            const code = prompt('Ø£Ø¯Ø®Ù„ ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ:');
            
            if (!code) return;
            
            const cleanCode = code.trim().toUpperCase().replace(/\s+/g, '');
            
            if (firebaseDB) {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ø§Ù„ÙƒÙˆØ¯
                const subscriptionsRef = firebaseDB.ref('restaurants');
                subscriptionsRef.orderByChild('subscriptionCode').equalTo(cleanCode).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            const userData = Object.values(snapshot.val())[0];
                            const userId = Object.keys(snapshot.val())[0];
                            
                            // Ø­ÙØ¸ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø§ØªØµØ§Ù„
                            const cloudConfig = {
                                username: userData.config?.username || 'User',
                                phone: userData.config?.phone || '',
                                restaurantName: userData.config?.restaurantName || '',
                                address: userData.config?.address || '',
                                subscriptionCode: cleanCode,
                                userId: userId,
                                active: true,
                                reconnectedAt: new Date().toISOString()
                            };
                            
                            LocalDB.save(LocalDB.KEYS.CLOUD_CONFIG, cloudConfig);
                            currentUserId = userId;
                            
                            // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
                            syncFromCloud(userId);
                            
                            showNotification('ØªÙ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
                            updateCloudStatus();
                        } else {
                            showNotification('ÙƒÙˆØ¯ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ ØºÙŠØ± ØµØ­ÙŠØ­', 'error');
                        }
                    })
                    .catch(err => {
                        console.error('Reconnect error:', err);
                        showNotification('Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„', 'error');
                    });
            }
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©
        function syncFromCloud(userId) {
            if (!firebaseDB) return;
            
            const userRef = firebaseDB.ref('restaurants/' + userId);
            userRef.once('value').then(snapshot => {
                const cloudData = snapshot.val();
                
                if (cloudData) {
                    // Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¨Ø¯ÙˆÙ† Ø§Ù„ØµÙˆØ±)
                    if (cloudData.products) LocalDB.save(LocalDB.KEYS.PRODUCTS, cloudData.products);
                    if (cloudData.categories) LocalDB.save(LocalDB.KEYS.CATEGORIES, cloudData.categories);
                    if (cloudData.invoices) LocalDB.save(LocalDB.KEYS.INVOICES, cloudData.invoices);
                    if (cloudData.expenses) LocalDB.save(LocalDB.KEYS.EXPENSES, cloudData.expenses);
                    if (cloudData.employees) LocalDB.save(LocalDB.KEYS.EMPLOYEES, cloudData.employees);
                    if (cloudData.users) LocalDB.save(LocalDB.KEYS.USERS, cloudData.users);
                    if (cloudData.settings) LocalDB.save(LocalDB.KEYS.SETTINGS, cloudData.settings);
                    
                    showNotification('ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø³Ø­Ø§Ø¨Ø©', 'success');
                    updateDashboardStats();
                }
            }).catch(err => {
                console.error('Sync from cloud error:', err);
            });
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø«ÙŠÙ…Ø§Øª
        function toggleTheme() {
            const body = document.body;
            const themeIcon = document.querySelector('.theme-toggle i');
            
            if (body.classList.contains('light-theme')) {
                body.classList.remove('light-theme');
                body.classList.add('dark-theme');
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
                LocalDB.save(LocalDB.KEYS.THEME, 'dark-theme');
                showNotification('ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„Ø¯Ø§ÙƒÙ†', 'success');
            } else {
                body.classList.remove('dark-theme');
                body.classList.add('light-theme');
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
                LocalDB.save(LocalDB.KEYS.THEME, 'light-theme');
                showNotification('ØªÙ… Ø§Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¥Ù„Ù‰ Ø§Ù„ÙˆØ¶Ø¹ Ø§Ù„ÙØ§ØªØ­', 'success');
            }
        }

        function changeThemeFromSelect() {
            const select = document.getElementById('themeSelect');
            const theme = select.value;
            const body = document.body;
            const themeIcon = document.querySelector('.theme-toggle i');
            
            body.classList.remove('light-theme', 'dark-theme');
            body.classList.add(theme);
            
            if (theme === 'dark-theme') {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            } else {
                themeIcon.classList.remove('fa-sun');
                themeIcon.classList.add('fa-moon');
            }
            
            LocalDB.save(LocalDB.KEYS.THEME, theme);
            showNotification('ØªÙ… ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø«ÙŠÙ… Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function loadTheme() {
            const savedTheme = LocalDB.get(LocalDB.KEYS.THEME) || 'light-theme';
            document.body.classList.add(savedTheme);
            
            const themeIcon = document.querySelector('.theme-toggle i');
            if (savedTheme === 'dark-theme') {
                themeIcon.classList.remove('fa-moon');
                themeIcon.classList.add('fa-sun');
            }
            
            const themeSelect = document.getElementById('themeSelect');
            if (themeSelect) {
                themeSelect.value = savedTheme;
            }
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type}`;
            notification.style.display = 'block';

            setTimeout(() => {
                notification.style.display = 'none';
            }, 3000);
        }

        // Ù†Ø¸Ø§Ù… Ø§Ù„ØªÙ†Ù‚Ù„
        function showPage(pageId) {
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));

            const page = document.getElementById(pageId);
            if (page) {
                page.classList.add('active');
                
                if (pageId === 'homePage') {
                    updateDashboardStats();
                } else if (pageId === 'posPage') {
                    loadPOSCategories();
                    loadPOSProducts();
                    loadCart();
                } else if (pageId === 'productsPage') {
                    loadProducts();
                    loadCategoriesForFilter();
                    updateProductStats();
                } else if (pageId === 'categoriesPage') {
                    loadCategories();
                } else if (pageId === 'invoicesPage') {
                    loadInvoices();
                } else if (pageId === 'expensesPage') {
                    loadExpenses();
                } else if (pageId === 'reportsPage') {
                    loadReports();
                } else if (pageId === 'usersPage') {
                    if (currentUser && currentUser.role === 'admin') {
                        loadUsers();
                    } else {
                        showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø§Ù„ÙˆØµÙˆÙ„ Ù„Ù‡Ø°Ù‡ Ø§Ù„ØµÙØ­Ø©', 'error');
                        showPage('homePage');
                    }
                } else if (pageId === 'employeesPage') {
                    loadEmployees();
                } else if (pageId === 'backupPage') {
                    updateCloudStatus();
                }
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„
        function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ (admin)
            if (username === 'admin' && password === 'admin') {
                currentUser = {
                    username: 'admin',
                    fullName: 'Ø§Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø¹Ø§Ù…',
                    role: 'admin',
                    permissions: ['all']
                };
                LocalDB.save(LocalDB.KEYS.CURRENT_USER, currentUser);
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('refreshBtn').classList.remove('hidden');
                
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                updateDashboardStats();
                checkUserPermissions();
                return;
            }

            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø§Ù„Ø¢Ø®Ø±ÙŠÙ†
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const user = users.find(u => u.username === username && u.password === password && u.active !== false);

            if (user) {
                currentUser = user;
                LocalDB.save(LocalDB.KEYS.CURRENT_USER, currentUser);
                
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('refreshBtn').classList.remove('hidden');
                
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                updateDashboardStats();
                checkUserPermissions();
            } else {
                showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø£Ùˆ ÙƒÙ„Ù…Ø© Ø§Ù„Ù…Ø±ÙˆØ± ØºÙŠØ± ØµØ­ÙŠØ­Ø©', 'error');
            }
        }

        // ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬
        function logout() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ØŸ')) {
                LocalDB.save(LocalDB.KEYS.CURRENT_USER, null);
                currentUser = null;
                userPermissions = [];
                
                document.getElementById('dashboard').classList.add('hidden');
                document.getElementById('loginScreen').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.add('hidden');
                document.getElementById('refreshBtn').classList.add('hidden');
                
                showNotification('ØªÙ… ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø®Ø±ÙˆØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
        function refreshApp() {
            if (confirm('Ø³ÙŠØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙˆØ¥Ø¹Ø§Ø¯Ø© ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª. Ù‡Ù„ ØªØ±ÙŠØ¯ Ø§Ù„Ù…ØªØ§Ø¨Ø¹Ø©ØŸ')) {
                location.reload();
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function checkUserPermissions() {
            currentUser = LocalDB.get(LocalDB.KEYS.CURRENT_USER);
            if (!currentUser) return;

            // ØªØ¹ÙŠÙŠÙ† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ÙÙ‚Ø·
            userPermissions = currentUser.permissions || [];

            // Ø¥Ø®ÙØ§Ø¡ Ù‚Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ† Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† admin
            if (currentUser.role !== 'admin') {
                const usersCard = document.getElementById('usersCard');
                if (usersCard) usersCard.style.display = 'none';
            }

            // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø²Ø±Ø§Ø± ÙˆØ§Ù„Ø£Ù‚Ø³Ø§Ù…
            applyPermissionsToUI();
        }

        // ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª Ø¹Ù„Ù‰ ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
        function applyPermissionsToUI() {
            if (currentUser.role === 'admin') {
                return; // Ø§Ù„Ù…Ø¯ÙŠØ± Ù„Ù‡ ÙƒÙ„ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª - Ù„Ø§ Ø­Ø§Ø¬Ø© Ù„Ø¥Ø®ÙØ§Ø¡ Ø´ÙŠØ¡
            }

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø¨Ù†Ø§Ø¡Ù‹ Ø¹Ù„Ù‰ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
            const permissionMap = {
                'products_add': '.btn-add-product, [onclick*="showAddProductModal"]',
                'products_edit': '.btn-edit-product, [onclick*="editProduct"]',
                'products_delete': '.btn-delete-product, [onclick*="deleteProduct"]',
                'expenses_add': '[onclick*="showAddExpenseModal"]',
                'expenses_edit': '.btn-edit-expense, [onclick*="editExpense"]',
                'expenses_delete': '.btn-delete-expense, [onclick*="deleteExpense"]',
                'settings_access': '.section-card[onclick*="settingsPage"]',
                'reports_view': '.section-card[onclick*="reportsPage"]',
                'backup_access': '.section-card[onclick*="backupPage"]',
                'pos_access': '.section-card[onclick*="posPage"]'
            };

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ Ù„Ø§ ÙŠÙ…Ù„Ùƒ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… ØµÙ„Ø§Ø­ÙŠØ© Ù„Ù‡Ø§
            Object.keys(permissionMap).forEach(permission => {
                if (!userPermissions.includes(permission) && !userPermissions.includes('all')) {
                    const selector = permissionMap[permission];
                    document.querySelectorAll(selector).forEach(el => {
                        if (el) el.style.display = 'none';
                    });
                }
            });

            // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø£Ù‚Ø³Ø§Ù… Ø§Ù„ÙƒØ§Ù…Ù„Ø© Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ©
            if (!hasPermission('products_view') && !hasPermission('products_add')) {
                const productsCard = document.querySelector('.section-card[onclick*="productsPage"]');
                if (productsCard) productsCard.style.display = 'none';
            }

            if (!hasPermission('expenses_view') && !hasPermission('expenses_add')) {
                const expensesCard = document.querySelector('.section-card[onclick*="expensesPage"]');
                if (expensesCard) expensesCard.style.display = 'none';
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙ„Ø§Ø­ÙŠØ© Ù…Ø¹ÙŠÙ†Ø©
        function hasPermission(permission) {
            if (!currentUser) return false;
            if (currentUser.role === 'admin') return true;
            if (!userPermissions || userPermissions.length === 0) return false; // Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù„Ø¯ÙŠÙ‡ ØµÙ„Ø§Ø­ÙŠØ§Øª - Ù„Ø§ ÙŠØ³ØªØ·ÙŠØ¹ ÙØ¹Ù„ Ø´ÙŠØ¡
            return userPermissions.includes(permission) || userPermissions.includes('all');
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function showAddUserModal() {
            if (!hasPermission('users_manage') && currentUser.role !== 'admin') {
                showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'error');
                return;
            }
            document.getElementById('userModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
            document.getElementById('userId').value = '';
            document.getElementById('userModal').querySelector('form').reset();
            document.querySelectorAll('.permission-check').forEach(cb => cb.checked = false);
            document.getElementById('userModal').style.display = 'block';
        }

        function saveUser(event) {
            event.preventDefault();
            
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const id = document.getElementById('userId').value;
            
            const permissions = [];
            document.querySelectorAll('.permission-check:checked').forEach(cb => {
                permissions.push(cb.value);
            });

            const userData = {
                username: document.getElementById('userName').value,
                password: document.getElementById('userPassword').value,
                fullName: document.getElementById('userFullName').value,
                email: document.getElementById('userEmail').value,
                role: document.getElementById('userRole').value,
                permissions: permissions,
                active: true,
                createdBy: currentUser.username,
                createdAt: new Date().toISOString()
            };

            if (id) {
                const index = users.findIndex(u => u.id == id);
                if (index !== -1) {
                    users[index] = { ...users[index], ...userData, updatedAt: new Date().toISOString() };
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            } else {
                if (users.find(u => u.username === userData.username)) {
                    showNotification('Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ù…ÙˆØ¬ÙˆØ¯ Ù…Ø³Ø¨Ù‚Ø§Ù‹', 'error');
                    return;
                }
                userData.id = Date.now();
                users.push(userData);
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            LocalDB.save(LocalDB.KEYS.USERS, users);
            closeModal('userModal');
            loadUsers();
            autoSyncToCloud(); // Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
        }

        function loadUsers() {
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const container = document.getElementById('usersTableContainer');

            document.getElementById('totalUsers').textContent = users.length;
            document.getElementById('activeUsers').textContent = users.filter(u => u.active !== false).length;

            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>';
                return;
            }

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                            <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                            <th>Ø§Ù„Ø¯ÙˆØ±</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>${user.username}</td>
                                <td>${user.fullName}</td>
                                <td>${user.email || '-'}</td>
                                <td>${user.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…'}</td>
                                <td>
                                    <span style="padding: 5px 10px; border-radius: 5px; background: ${user.active !== false ? 'var(--success-color)' : 'var(--danger-color)'}; color: white; font-size: 12px;">
                                        ${user.active !== false ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}
                                    </span>
                                </td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick='viewUserDetails(${JSON.stringify(user)})' title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="editUser(${user.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm ${user.active !== false ? 'btn-danger' : 'btn-success'}" onclick="toggleUserStatus(${user.id})" title="${user.active !== false ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}">
                                        <i class="fas fa-${user.active !== false ? 'ban' : 'check'}"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function viewUserDetails(user) {
            const permissionsHtml = user.permissions && user.permissions.length > 0 
                ? user.permissions.map(p => `<span style="display: inline-block; padding: 5px 10px; background: var(--primary-color); color: white; border-radius: 5px; margin: 5px; font-size: 12px;">${translatePermission(p)}</span>`).join('')
                : '<span style="color: var(--text-secondary);">Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ„Ø§Ø­ÙŠØ§Øª</span>';

            const html = `
                <table style="width: 100%;">
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</td><td style="padding: 10px;">${user.username}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</td><td style="padding: 10px;">${user.fullName}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</td><td style="padding: 10px;">${user.email || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø¯ÙˆØ±:</td><td style="padding: 10px;">${user.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø­Ø§Ù„Ø©:</td><td style="padding: 10px;">${user.active !== false ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px; vertical-align: top;">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:</td><td style="padding: 10px;">${permissionsHtml}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ù†Ø´Ø§Ø¡:</td><td style="padding: 10px;">${formatDate(user.createdAt)}</td></tr>
                </table>
            `;

            document.getElementById('detailsModalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
            document.getElementById('detailsContent').innerHTML = html;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function translatePermission(permission) {
            const translations = {
                'products_add': 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬Ø§Øª', 'products_edit': 'ØªØ¹Ø¯ÙŠÙ„ Ù…Ù†ØªØ¬Ø§Øª',
                'products_delete': 'Ø­Ø°Ù Ù…Ù†ØªØ¬Ø§Øª', 'products_view': 'Ø¹Ø±Ø¶ Ù…Ù†ØªØ¬Ø§Øª',
                'expenses_add': 'Ø¥Ø¶Ø§ÙØ© Ù…ØµØ§Ø±ÙŠÙ', 'expenses_edit': 'ØªØ¹Ø¯ÙŠÙ„ Ù…ØµØ§Ø±ÙŠÙ',
                'expenses_delete': 'Ø­Ø°Ù Ù…ØµØ§Ø±ÙŠÙ', 'expenses_view': 'Ø¹Ø±Ø¶ Ù…ØµØ§Ø±ÙŠÙ',
                'invoices_view': 'Ø¹Ø±Ø¶ ÙÙˆØ§ØªÙŠØ±', 'invoices_delete': 'Ø­Ø°Ù ÙÙˆØ§ØªÙŠØ±',
                'pos_access': 'Ù†Ù‚Ø·Ø© Ø§Ù„Ø¨ÙŠØ¹', 'settings_access': 'Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª',
                'reports_view': 'Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ±', 'backup_access': 'Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ'
            };
            return translations[permission] || permission;
        }

        function editUser(id) {
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const user = users.find(u => u.id == id);
            
            if (user) {
                document.getElementById('userModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
                document.getElementById('userId').value = user.id;
                document.getElementById('userName').value = user.username;
                document.getElementById('userPassword').value = user.password;
                document.getElementById('userFullName').value = user.fullName;
                document.getElementById('userEmail').value = user.email || '';
                document.getElementById('userRole').value = user.role;
                
                document.querySelectorAll('.permission-check').forEach(cb => {
                    cb.checked = user.permissions && user.permissions.includes(cb.value);
                });
                
                document.getElementById('userModal').style.display = 'block';
            }
        }

        function toggleUserStatus(id) {
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const user = users.find(u => u.id == id);
            
            if (user) {
                user.active = !user.active;
                LocalDB.save(LocalDB.KEYS.USERS, users);
                loadUsers();
                showNotification(`ØªÙ… ${user.active ? 'ØªÙØ¹ÙŠÙ„' : 'ØªØ¹Ø·ÙŠÙ„'} Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­`, 'success');
            }
        }

        function deleteUser(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
                const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
                const updated = users.filter(u => u.id !== id);
                LocalDB.save(LocalDB.KEYS.USERS, updated);
                loadUsers();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function showAddEmployeeModal() {
            document.getElementById('employeeModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯';
            document.getElementById('employeeId').value = '';
            document.getElementById('employeeModal').querySelector('form').reset();
            document.getElementById('employeeImagePreview').classList.add('hidden');
            document.getElementById('employeeHireDate').valueAsDate = new Date();
            document.getElementById('employeeModal').style.display = 'block';
        }

        function saveEmployee(event) {
            event.preventDefault();
            
            const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
            const id = document.getElementById('employeeId').value;
            
            const imagePreview = document.getElementById('employeeImagePreview');
            const employeeData = {
                name: document.getElementById('employeeName').value,
                phone: document.getElementById('employeePhone').value,
                address: document.getElementById('employeeAddress').value,
                salary: parseFloat(document.getElementById('employeeSalary').value),
                hireDate: document.getElementById('employeeHireDate').value,
                position: document.getElementById('employeePosition').value,
                notes: document.getElementById('employeeNotes').value,
                image: imagePreview.src && !imagePreview.classList.contains('hidden') ? imagePreview.src : null,
                addedBy: currentUser.username,
                updatedAt: new Date().toISOString()
            };

            if (id) {
                const index = employees.findIndex(e => e.id == id);
                if (index !== -1) {
                    employees[index] = { ...employees[index], ...employeeData };
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            } else {
                employeeData.id = Date.now();
                employeeData.createdAt = new Date().toISOString();
                employees.push(employeeData);
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            LocalDB.save(LocalDB.KEYS.EMPLOYEES, employees);
            closeModal('employeeModal');
            loadEmployees();
        }

        function loadEmployees() {
            const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
            const container = document.getElementById('employeesTableContainer');
            const searchTerm = document.getElementById('searchEmployees')?.value.toLowerCase() || '';

            let filteredEmployees = employees;
            if (searchTerm) {
                filteredEmployees = filteredEmployees.filter(e => 
                    e.name.toLowerCase().includes(searchTerm) ||
                    e.phone.includes(searchTerm) ||
                    e.position?.toLowerCase().includes(searchTerm)
                );
            }

            const totalSalaries = employees.reduce((sum, e) => sum + e.salary, 0);
            const avgSalary = employees.length > 0 ? totalSalaries / employees.length : 0;

            document.getElementById('totalEmployees').textContent = employees.length;
            document.getElementById('totalSalaries').textContent = formatNumber(totalSalaries) + ' Ø¯.Ø¹';
            document.getElementById('avgSalary').textContent = formatNumber(avgSalary) + ' Ø¯.Ø¹';

            if (filteredEmployees.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</p>';
                return;
            }

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th>Ø§Ù„Ù…Ù†ØµØ¨</th>
                            <th>Ø§Ù„Ø±Ø§ØªØ¨</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredEmployees.map(employee => `
                            <tr>
                                <td><img src="${employee.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23ddd\' width=\'50\' height=\'50\'/%3E%3Ctext fill=\'%23999\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3E${employee.name.charAt(0)}%3C/text%3E%3C/svg%3E'}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;"></td>
                                <td>${employee.name}</td>
                                <td>${employee.phone}</td>
                                <td>${employee.position || '-'}</td>
                                <td style="font-weight: 700; color: var(--success-color);">${formatNumber(employee.salary)} Ø¯.Ø¹</td>
                                <td>${formatDate(employee.hireDate)}</td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick='viewEmployeeDetails(${JSON.stringify(employee)})'>
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="editEmployee(${employee.id})">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employee.id})">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function viewEmployeeDetails(employee) {
            const html = `
                <div style="text-align: center;">
                    <img src="${employee.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'150\' height=\'150\'%3E%3Crect fill=\'%23ddd\' width=\'150\' height=\'150\'/%3E%3C/svg%3E'}" style="width: 150px; height: 150px; object-fit: cover; border-radius: 50%; margin-bottom: 20px;">
                </div>
                <table style="width: 100%;">
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø§Ø³Ù…:</td><td style="padding: 10px;">${employee.name}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ù‡Ø§ØªÙ:</td><td style="padding: 10px;">${employee.phone}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</td><td style="padding: 10px;">${employee.address || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ù…Ù†ØµØ¨:</td><td style="padding: 10px;">${employee.position || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø±Ø§ØªØ¨:</td><td style="padding: 10px; color: var(--success-color); font-weight: 700;">${formatNumber(employee.salary)} Ø¯.Ø¹</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</td><td style="padding: 10px;">${formatDate(employee.hireDate)}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</td><td style="padding: 10px;">${employee.notes || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ù…Ù† Ø£Ø¶Ø§ÙÙ‡:</td><td style="padding: 10px;">${employee.addedBy || 'admin'}</td></tr>
                </table>
            `;

            document.getElementById('detailsModalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù';
            document.getElementById('detailsContent').innerHTML = html;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function editEmployee(id) {
            const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
            const employee = employees.find(e => e.id == id);
            
            if (employee) {
                document.getElementById('employeeModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù';
                document.getElementById('employeeId').value = employee.id;
                document.getElementById('employeeName').value = employee.name;
                document.getElementById('employeePhone').value = employee.phone;
                document.getElementById('employeeAddress').value = employee.address || '';
                document.getElementById('employeeSalary').value = employee.salary;
                document.getElementById('employeeHireDate').value = employee.hireDate;
                document.getElementById('employeePosition').value = employee.position || '';
                document.getElementById('employeeNotes').value = employee.notes || '';
                
                if (employee.image) {
                    const preview = document.getElementById('employeeImagePreview');
                    preview.src = employee.image;
                    preview.classList.remove('hidden');
                }
                
                document.getElementById('employeeModal').style.display = 'block';
            }
        }

        function deleteEmployee(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ')) {
                const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
                const updated = employees.filter(e => e.id !== id);
                LocalDB.save(LocalDB.KEYS.EMPLOYEES, updated);
                loadEmployees();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }


        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†
        function showAddUserModal() {
            if (!hasPermission('users_manage') && currentUser.role !== 'admin') {
                showNotification('Ù„ÙŠØ³ Ù„Ø¯ÙŠÙƒ ØµÙ„Ø§Ø­ÙŠØ© Ù„Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†', 'error');
                return;
            }
            
            document.getElementById('userModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªØ®Ø¯Ù… Ø¬Ø¯ÙŠØ¯';
            document.getElementById('userId').value = '';
            document.getElementById('userModal').querySelector('form').reset();
            document.querySelectorAll('.permission-check').forEach(cb => cb.checked = false);
            document.getElementById('userModal').style.display = 'block';
        }

        function saveUser(event) {
            event.preventDefault();
            
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const id = document.getElementById('userId').value;
            
            const permissions = [];
            document.querySelectorAll('.permission-check:checked').forEach(cb => {
                permissions.push(cb.value);
            });

            const userData = {
                username: document.getElementById('userName').value,
                password: document.getElementById('userPassword').value,
                fullName: document.getElementById('userFullName').value,
                email: document.getElementById('userEmail').value,
                role: document.getElementById('userRole').value,
                permissions: permissions,
                active: true,
                createdBy: currentUser.username,
                updatedAt: new Date().toISOString()
            };

            if (id) {
                const index = users.findIndex(u => u.id == id);
                if (index !== -1) {
                    users[index] = { ...users[index], ...userData };
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            } else {
                userData.id = Date.now();
                userData.createdAt = new Date().toISOString();
                users.push(userData);
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            LocalDB.save(LocalDB.KEYS.USERS, users);
            closeModal('userModal');
            loadUsers();
            event.target.reset();
        }

        function loadUsers() {
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const container = document.getElementById('usersTableContainer');

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const totalUsers = users.length;
            const admins = users.filter(u => u.role === 'admin').length + 1; // +1 Ù„Ù„Ù…Ø¯ÙŠØ± Ø§Ù„Ø£Ø³Ø§Ø³ÙŠ
            const activeUsers = users.filter(u => u.active !== false).length;

            document.getElementById('totalUsers').textContent = totalUsers;
            document.getElementById('totalAdmins').textContent = admins;
            document.getElementById('activeUsers').textContent = activeUsers;

            if (users.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…Ø³ØªØ®Ø¯Ù…ÙŠÙ†</p>';
                return;
            }

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…</th>
                            <th>Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„</th>
                            <th>Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ</th>
                            <th>Ø§Ù„Ø¯ÙˆØ±</th>
                            <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${users.map(user => `
                            <tr>
                                <td>${user.username}</td>
                                <td>${user.fullName}</td>
                                <td>${user.email || '-'}</td>
                                <td><span style="padding: 5px 10px; border-radius: 5px; background: ${user.role === 'admin' ? 'var(--primary-color)' : 'var(--info-color)'}; color: white; font-size: 12px;">${user.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…'}</span></td>
                                <td><span style="padding: 5px 10px; border-radius: 5px; background: ${user.active !== false ? 'var(--success-color)' : 'var(--danger-color)'}; color: white; font-size: 12px;">${user.active !== false ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}</span></td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick='viewUserDetails(${JSON.stringify(user)})' title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="editUser(${user.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm ${user.active !== false ? 'btn-secondary' : 'btn-success'}" onclick="toggleUserStatus(${user.id})" title="${user.active !== false ? 'ØªØ¹Ø·ÙŠÙ„' : 'ØªÙØ¹ÙŠÙ„'}">
                                        <i class="fas fa-${user.active !== false ? 'ban' : 'check'}"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteUser(${user.id})" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function viewUserDetails(user) {
            const permissionsText = user.permissions && user.permissions.length > 0 
                ? user.permissions.map(p => p.replace(/_/g, ' ')).join(', ') 
                : 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØµÙ„Ø§Ø­ÙŠØ§Øª';

            const html = `
                <table style="width: 100%;">
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ø³Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…:</td><td style="padding: 10px;">${user.username}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø§Ø³Ù… Ø§Ù„ÙƒØ§Ù…Ù„:</td><td style="padding: 10px;">${user.fullName}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</td><td style="padding: 10px;">${user.email || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø¯ÙˆØ±:</td><td style="padding: 10px;">${user.role === 'admin' ? 'Ù…Ø¯ÙŠØ±' : 'Ù…Ø³ØªØ®Ø¯Ù…'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø­Ø§Ù„Ø©:</td><td style="padding: 10px;">${user.active !== false ? 'Ù†Ø´Ø·' : 'Ù…Ø¹Ø·Ù„'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª:</td><td style="padding: 10px;">${permissionsText}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ù…Ù† Ø£Ø¶Ø§ÙÙ‡:</td><td style="padding: 10px;">${user.createdBy || 'admin'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</td><td style="padding: 10px;">${formatDate(user.createdAt || user.updatedAt)}</td></tr>
                </table>
            `;

            document.getElementById('detailsModalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
            document.getElementById('detailsContent').innerHTML = html;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function editUser(id) {
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const user = users.find(u => u.id == id);
            
            if (user) {
                document.getElementById('userModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…';
                document.getElementById('userId').value = user.id;
                document.getElementById('userName').value = user.username;
                document.getElementById('userPassword').value = user.password;
                document.getElementById('userFullName').value = user.fullName;
                document.getElementById('userEmail').value = user.email || '';
                document.getElementById('userRole').value = user.role;
                
                // ØªØ­Ø¯ÙŠØ¯ Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª
                document.querySelectorAll('.permission-check').forEach(cb => {
                    cb.checked = user.permissions && user.permissions.includes(cb.value);
                });
                
                document.getElementById('userModal').style.display = 'block';
            }
        }

        function toggleUserStatus(id) {
            const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
            const user = users.find(u => u.id == id);
            
            if (user) {
                user.active = user.active === false ? true : false;
                LocalDB.save(LocalDB.KEYS.USERS, users);
                loadUsers();
                showNotification(user.active ? 'ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…' : 'ØªÙ… ØªØ¹Ø·ÙŠÙ„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…', 'success');
            }
        }

        function deleteUser(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…ØŸ')) {
                const users = LocalDB.get(LocalDB.KEYS.USERS) || [];
                const updated = users.filter(u => u.id !== id);
                LocalDB.save(LocalDB.KEYS.USERS, updated);
                loadUsers();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ÙˆØ¸ÙÙŠÙ†
        function showAddEmployeeModal() {
            document.getElementById('employeeModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…ÙˆØ¸Ù Ø¬Ø¯ÙŠØ¯';
            document.getElementById('employeeId').value = '';
            document.getElementById('employeeModal').querySelector('form').reset();
            document.getElementById('employeeImagePreview').classList.add('hidden');
            document.getElementById('employeeHireDate').valueAsDate = new Date();
            document.getElementById('employeeModal').style.display = 'block';
        }

        function saveEmployee(event) {
            event.preventDefault();
            
            const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
            const id = document.getElementById('employeeId').value;
            
            const imagePreview = document.getElementById('employeeImagePreview');
            const employeeData = {
                name: document.getElementById('employeeName').value,
                phone: document.getElementById('employeePhone').value,
                address: document.getElementById('employeeAddress').value,
                salary: parseFloat(document.getElementById('employeeSalary').value),
                hireDate: document.getElementById('employeeHireDate').value,
                position: document.getElementById('employeePosition').value,
                notes: document.getElementById('employeeNotes').value,
                image: imagePreview.src && !imagePreview.classList.contains('hidden') ? imagePreview.src : null,
                addedBy: currentUser.username,
                updatedAt: new Date().toISOString()
            };

            if (id) {
                const index = employees.findIndex(e => e.id == id);
                if (index !== -1) {
                    employees[index] = { ...employees[index], ...employeeData };
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            } else {
                employeeData.id = Date.now();
                employeeData.createdAt = new Date().toISOString();
                employees.push(employeeData);
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            LocalDB.save(LocalDB.KEYS.EMPLOYEES, employees);
            closeModal('employeeModal');
            loadEmployees();
            autoSyncToCloud(); // Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            event.target.reset();
        }

        function loadEmployees() {
            const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
            const container = document.getElementById('employeesTableContainer');
            const searchTerm = document.getElementById('searchEmployees')?.value.toLowerCase() || '';

            let filteredEmployees = employees;

            if (searchTerm) {
                filteredEmployees = filteredEmployees.filter(e => 
                    e.name.toLowerCase().includes(searchTerm) ||
                    e.phone?.includes(searchTerm) ||
                    e.position?.toLowerCase().includes(searchTerm)
                );
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const totalEmployees = employees.length;
            const totalSalaries = employees.reduce((sum, e) => sum + (e.salary || 0), 0);
            const avgSalary = totalEmployees > 0 ? totalSalaries / totalEmployees : 0;

            document.getElementById('totalEmployees').textContent = totalEmployees;
            document.getElementById('totalSalaries').textContent = formatNumber(totalSalaries) + ' Ø¯.Ø¹';
            document.getElementById('avgSalary').textContent = formatNumber(avgSalary) + ' Ø¯.Ø¹';

            if (filteredEmployees.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ù…ÙˆØ¸ÙÙŠÙ†</p>';
                return;
            }

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ</th>
                            <th>Ø§Ù„Ù…Ù†ØµØ¨</th>
                            <th>Ø§Ù„Ø±Ø§ØªØ¨</th>
                            <th>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredEmployees.map(employee => `
                            <tr>
                                <td><img src="${employee.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23ddd\' width=\'50\' height=\'50\'/%3E%3Ctext fill=\'%23999\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3EğŸ‘¤%3C/text%3E%3C/svg%3E'}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 50%;" alt="${employee.name}"></td>
                                <td>${employee.name}</td>
                                <td>${employee.phone}</td>
                                <td>${employee.position || '-'}</td>
                                <td>${formatNumber(employee.salary)} Ø¯.Ø¹</td>
                                <td>${formatDate(employee.hireDate)}</td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick='viewEmployeeDetails(${JSON.stringify(employee)})' title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="editEmployee(${employee.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${employee.id})" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function viewEmployeeDetails(employee) {
            const html = `
                <div style="text-align: center;">
                    <img src="${employee.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'150\' height=\'150\'%3E%3Crect fill=\'%23ddd\' width=\'150\' height=\'150\'/%3E%3Ctext fill=\'%23999\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\' font-size=\'50\'%3EğŸ‘¤%3C/text%3E%3C/svg%3E'}" style="width: 150px; height: 150px; border-radius: 50%; margin-bottom: 20px; object-fit: cover;" alt="${employee.name}">
                </div>
                <table style="width: 100%;">
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø§Ø³Ù…:</td><td style="padding: 10px;">${employee.name}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø±Ù‚Ù… Ø§Ù„Ù‡Ø§ØªÙ:</td><td style="padding: 10px;">${employee.phone}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</td><td style="padding: 10px;">${employee.address || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ù…Ù†ØµØ¨:</td><td style="padding: 10px;">${employee.position || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø±Ø§ØªØ¨ Ø§Ù„Ø´Ù‡Ø±ÙŠ:</td><td style="padding: 10px; color: var(--success-color);">${formatNumber(employee.salary)} Ø¯.Ø¹</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†:</td><td style="padding: 10px;">${formatDate(employee.hireDate)}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ù…Ù„Ø§Ø­Ø¸Ø§Øª:</td><td style="padding: 10px;">${employee.notes || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ù…Ù† Ø£Ø¶Ø§ÙÙ‡:</td><td style="padding: 10px;">${employee.addedBy || 'admin'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</td><td style="padding: 10px;">${formatDate(employee.createdAt || employee.updatedAt)}</td></tr>
                </table>
            `;

            document.getElementById('detailsModalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ÙˆØ¸Ù';
            document.getElementById('detailsContent').innerHTML = html;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function editEmployee(id) {
            const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
            const employee = employees.find(e => e.id == id);
            
            if (employee) {
                document.getElementById('employeeModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…ÙˆØ¸Ù';
                document.getElementById('employeeId').value = employee.id;
                document.getElementById('employeeName').value = employee.name;
                document.getElementById('employeePhone').value = employee.phone;
                document.getElementById('employeeAddress').value = employee.address || '';
                document.getElementById('employeeSalary').value = employee.salary;
                document.getElementById('employeeHireDate').value = employee.hireDate;
                document.getElementById('employeePosition').value = employee.position || '';
                document.getElementById('employeeNotes').value = employee.notes || '';
                
                if (employee.image) {
                    const preview = document.getElementById('employeeImagePreview');
                    preview.src = employee.image;
                    preview.classList.remove('hidden');
                }
                
                document.getElementById('employeeModal').style.display = 'block';
            }
        }

        function deleteEmployee(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆØ¸ÙØŸ')) {
                const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
                const updated = employees.filter(e => e.id !== id);
                LocalDB.save(LocalDB.KEYS.EMPLOYEES, updated);
                loadEmployees();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ÙˆØ¸Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }
        function loadPOSCategories() {
            const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
            const container = document.getElementById('posCategories');
            
            let html = '<div class="category-tab active" data-category="all" onclick="filterPOSProducts(\'all\')">Ø§Ù„ÙƒÙ„</div>';
            categories.forEach(cat => {
                html += `<div class="category-tab" data-category="${cat.id}" onclick="filterPOSProducts(${cat.id})">${cat.name}</div>`;
            });
            
            container.innerHTML = html;
        }

        function loadPOSProducts(categoryFilter = 'all') {
            const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
            const container = document.getElementById('posProductsGrid');
            
            let filteredProducts = categoryFilter === 'all' 
                ? products 
                : products.filter(p => p.category == categoryFilter);

            if (filteredProducts.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px; grid-column: 1/-1;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>';
                return;
            }

            container.innerHTML = filteredProducts.map(product => `
                <div class="product-item" onclick='showAddToCartModal(${JSON.stringify(product)})'>
                    <img src="${product.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'100\' height=\'100\'%3E%3Crect fill=\'%23ddd\' width=\'100\' height=\'100\'/%3E%3Ctext fill=\'%23999\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3EØµÙˆØ±Ø©%3C/text%3E%3C/svg%3E'}" class="product-image" alt="${product.name}">
                    <div class="product-name">${product.name}</div>
                    <div class="product-price">${formatNumber(product.price)} Ø¯.Ø¹</div>
                </div>
            `).join('');
        }

        function filterPOSProducts(categoryId) {
            // ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ†ÙŠÙ Ø§Ù„Ù†Ø´Ø·
            document.querySelectorAll('.category-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            loadPOSProducts(categoryId);
        }

        function showAddToCartModal(product) {
            selectedProduct = product;
            document.getElementById('cartProductImage').src = product.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'150\' height=\'150\'%3E%3Crect fill=\'%23ddd\' width=\'150\' height=\'150\'/%3E%3Ctext fill=\'%23999\' x=\'50%25\' y=\'50%25\' text-anchor=\'middle\' dy=\'.3em\'%3EØµÙˆØ±Ø©%3C/text%3E%3C/svg%3E';
            document.getElementById('cartProductName').textContent = product.name;
            document.getElementById('cartProductPrice').textContent = formatNumber(product.price) + ' Ø¯.Ø¹';
            document.getElementById('cartQuantity').value = 1;
            document.getElementById('addToCartModal').style.display = 'block';
        }

        function confirmAddToCart() {
            const quantity = parseInt(document.getElementById('cartQuantity').value);
            
            if (quantity < 1) {
                showNotification('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ ÙƒÙ…ÙŠØ© ØµØ­ÙŠØ­Ø©', 'error');
                return;
            }

            const existingItem = currentCart.find(item => item.id === selectedProduct.id);
            
            if (existingItem) {
                existingItem.quantity += quantity;
            } else {
                currentCart.push({
                    ...selectedProduct,
                    quantity: quantity
                });
            }

            LocalDB.save(LocalDB.KEYS.CART, currentCart);
            updateCart();
            closeModal('addToCartModal');
            showNotification('ØªÙ…Øª Ø§Ù„Ø¥Ø¶Ø§ÙØ© Ø¥Ù„Ù‰ Ø§Ù„Ø³Ù„Ø©', 'success');
        }

        function loadCart() {
            currentCart = LocalDB.get(LocalDB.KEYS.CART) || [];
            updateCart();
        }

        function updateCart() {
            const container = document.getElementById('cartItems');
            
            if (currentCart.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©</p>';
                document.getElementById('cartSubtotal').textContent = '0 Ø¯.Ø¹';
                document.getElementById('cartTotal').textContent = '0 Ø¯.Ø¹';
                return;
            }

            let subtotal = 0;

            container.innerHTML = currentCart.map((item, index) => {
                const itemTotal = item.price * item.quantity;
                subtotal += itemTotal;

                return `
                    <div class="cart-item">
                        <div class="cart-item-info">
                            <div class="cart-item-name">${item.name}</div>
                            <div class="cart-item-details">${formatNumber(item.price)} Ø¯.Ø¹ Ã— ${item.quantity}</div>
                            <div class="cart-item-quantity">
                                <button class="qty-btn" onclick="updateQuantity(${index}, -1)">-</button>
                                <span>${item.quantity}</span>
                                <button class="qty-btn" onclick="updateQuantity(${index}, 1)">+</button>
                            </div>
                        </div>
                        <div>
                            <div style="font-weight: 700; margin-bottom: 10px; color: var(--primary-color);">${formatNumber(itemTotal)} Ø¯.Ø¹</div>
                            <button class="btn btn-sm btn-danger" onclick="removeFromCart(${index})">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('cartSubtotal').textContent = formatNumber(subtotal) + ' Ø¯.Ø¹';
            document.getElementById('cartTotal').textContent = formatNumber(subtotal) + ' Ø¯.Ø¹';
        }

        function updateQuantity(index, change) {
            currentCart[index].quantity += change;
            
            if (currentCart[index].quantity <= 0) {
                currentCart.splice(index, 1);
            }

            LocalDB.save(LocalDB.KEYS.CART, currentCart);
            updateCart();
        }

        function removeFromCart(index) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ')) {
                currentCart.splice(index, 1);
                LocalDB.save(LocalDB.KEYS.CART, currentCart);
                updateCart();
                showNotification('ØªÙ… Ø§Ù„Ø­Ø°Ù Ù…Ù† Ø§Ù„Ø³Ù„Ø©', 'success');
            }
        }

        function clearCart() {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ù…Ø³Ø­ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª Ù…Ù† Ø§Ù„Ø³Ù„Ø©ØŸ')) {
                currentCart = [];
                LocalDB.save(LocalDB.KEYS.CART, currentCart);
                updateCart();
                showNotification('ØªÙ… Ù…Ø³Ø­ Ø§Ù„Ø³Ù„Ø©', 'success');
            }
        }

        function suspendOrder() {
            if (currentCart.length === 0) {
                showNotification('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'warning');
                return;
            }

            const suspendedOrders = LocalDB.get(LocalDB.KEYS.SUSPENDED_ORDERS) || [];
            suspendedOrders.push({
                id: Date.now(),
                items: [...currentCart],
                date: new Date().toISOString()
            });

            LocalDB.save(LocalDB.KEYS.SUSPENDED_ORDERS, suspendedOrders);
            currentCart = [];
            LocalDB.save(LocalDB.KEYS.CART, currentCart);
            updateCart();
            showNotification('ØªÙ… ØªØ¹Ù„ÙŠÙ‚ Ø§Ù„Ø·Ù„Ø¨', 'success');
        }

        function showSuspendedOrders() {
            const orders = LocalDB.get(LocalDB.KEYS.SUSPENDED_ORDERS) || [];
            const container = document.getElementById('suspendedOrdersList');

            if (orders.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</p>';
                document.getElementById('suspendedOrdersModal').style.display = 'block';
                return;
            }

            if (orders.length === 1) {
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø·Ù„Ø¨ ÙˆØ§Ø­Ø¯ØŒ Ø£Ø¹Ø¯Ù‡ Ù…Ø¨Ø§Ø´Ø±Ø©
                restoreSuspendedOrder(0);
                return;
            }

            container.innerHTML = orders.map((order, index) => `
                <div class="card" style="margin-bottom: 15px;">
                    <div class="card-body">
                        <h4>Ø·Ù„Ø¨ #${order.id}</h4>
                        <p style="color: var(--text-secondary);">${formatDate(order.date)}</p>
                        <p>Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª: ${order.items.length}</p>
                        <button class="btn btn-primary btn-sm" onclick="restoreSuspendedOrder(${index})">
                            <i class="fas fa-undo"></i>
                            Ø§Ø³ØªØ±Ø¬Ø§Ø¹
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteSuspendedOrder(${index})">
                            <i class="fas fa-trash"></i>
                            Ø­Ø°Ù
                        </button>
                    </div>
                </div>
            `).join('');

            document.getElementById('suspendedOrdersModal').style.display = 'block';
        }

        function restoreSuspendedOrder(index) {
            const orders = LocalDB.get(LocalDB.KEYS.SUSPENDED_ORDERS) || [];
            currentCart = orders[index].items;
            orders.splice(index, 1);
            LocalDB.save(LocalDB.KEYS.SUSPENDED_ORDERS, orders);
            LocalDB.save(LocalDB.KEYS.CART, currentCart);
            updateCart();
            closeModal('suspendedOrdersModal');
            showNotification('ØªÙ… Ø§Ø³ØªØ±Ø¬Ø§Ø¹ Ø§Ù„Ø·Ù„Ø¨', 'success');
        }

        function deleteSuspendedOrder(index) {
            if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø·Ù„Ø¨ØŸ')) {
                const orders = LocalDB.get(LocalDB.KEYS.SUSPENDED_ORDERS) || [];
                orders.splice(index, 1);
                LocalDB.save(LocalDB.KEYS.SUSPENDED_ORDERS, orders);
                showSuspendedOrders();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ø·Ù„Ø¨', 'success');
            }
        }

        function completeSale() {
            if (currentCart.length === 0) {
                showNotification('Ø§Ù„Ø³Ù„Ø© ÙØ§Ø±ØºØ©', 'warning');
                return;
            }

            const invoices = LocalDB.get(LocalDB.KEYS.INVOICES) || [];
            
            let total = 0;
            let totalCost = 0;
            
            currentCart.forEach(item => {
                total += item.price * item.quantity;
                totalCost += (item.cost || 0) * item.quantity;
            });

            const invoice = {
                id: Date.now(),
                items: [...currentCart],
                total: total,
                cost: totalCost,
                profit: total - totalCost,
                date: new Date().toISOString().split('T')[0],
                time: new Date().toLocaleTimeString('ar-IQ'),
                addedBy: currentUser ? currentUser.username : 'admin'
            };

            invoices.push(invoice);
            LocalDB.save(LocalDB.KEYS.INVOICES, invoices);

            currentCart = [];
            LocalDB.save(LocalDB.KEYS.CART, currentCart);
            updateCart();
            updateDashboardStats();
            autoSyncToCloud(); // Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©

            showNotification('ØªÙ…Øª Ø¹Ù…Ù„ÙŠØ© Ø§Ù„Ø¨ÙŠØ¹ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†ØªØ¬Ø§Øª
        function showAddProductModal() {
            document.getElementById('productModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…Ù†ØªØ¬ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('productId').value = '';
            document.getElementById('productModal').querySelector('form').reset();
            document.getElementById('productImagePreview').classList.add('hidden');
            loadCategoriesForProduct();
            document.getElementById('productModal').style.display = 'block';
        }

        function previewImage(event, previewId) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById(previewId);
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function saveProduct(event) {
            event.preventDefault();
            
            const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
            const id = document.getElementById('productId').value;
            
            const imagePreview = document.getElementById('productImagePreview');
            const productData = {
                name: document.getElementById('productName').value,
                category: document.getElementById('productCategory').value,
                cost: parseFloat(document.getElementById('productCost').value),
                price: parseFloat(document.getElementById('productPrice').value),
                description: document.getElementById('productDescription').value,
                image: imagePreview.src && !imagePreview.classList.contains('hidden') ? imagePreview.src : null,
                addedBy: currentUser ? currentUser.username : 'admin',
                updatedAt: new Date().toISOString()
            };

            if (id) {
                // ØªØ­Ø¯ÙŠØ«
                const index = products.findIndex(p => p.id == id);
                if (index !== -1) {
                    products[index] = { ...products[index], ...productData };
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            } else {
                // Ø¥Ø¶Ø§ÙØ© Ø¬Ø¯ÙŠØ¯
                productData.id = Date.now();
                productData.createdAt = new Date().toISOString();
                products.push(productData);
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            LocalDB.save(LocalDB.KEYS.PRODUCTS, products);
            closeModal('productModal');
            loadProducts();
            updateProductStats();
            autoSyncToCloud(); // Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            event.target.reset();
        }

        function loadCategoriesForProduct() {
            const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
            const select = document.getElementById('productCategory');
            
            select.innerHTML = '<option value="">Ø§Ø®ØªØ± Ø§Ù„ØªØµÙ†ÙŠÙ</option>';
            categories.forEach(cat => {
                select.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
            });
        }

        function loadCategoriesForFilter() {
            const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
            const select = document.getElementById('filterCategory');
            
            if (select) {
                select.innerHTML = '<option value="">Ø§Ù„ÙƒÙ„</option>';
                categories.forEach(cat => {
                    select.innerHTML += `<option value="${cat.id}">${cat.name}</option>`;
                });
            }
        }

        function loadProducts() {
            const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
            const container = document.getElementById('productsTableContainer');
            const searchTerm = document.getElementById('searchProducts')?.value.toLowerCase() || '';
            const filterCat = document.getElementById('filterCategory')?.value || '';

            let filteredProducts = products;

            if (searchTerm) {
                filteredProducts = filteredProducts.filter(p => 
                    p.name.toLowerCase().includes(searchTerm) ||
                    p.description?.toLowerCase().includes(searchTerm)
                );
            }

            if (filterCat) {
                filteredProducts = filteredProducts.filter(p => p.category == filterCat);
            }

            if (filteredProducts.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…Ù†ØªØ¬Ø§Øª</p>';
                return;
            }

            const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
            
            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„ØµÙˆØ±Ø©</th>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„ØªØµÙ†ÙŠÙ</th>
                            <th>Ø§Ù„ØªÙƒÙ„ÙØ©</th>
                            <th>Ø§Ù„Ø³Ø¹Ø±</th>
                            <th>Ø§Ù„Ø±Ø¨Ø­</th>
                            <th>Ù…Ù† Ø£Ø¶Ø§ÙÙ‡</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredProducts.map(product => {
                            const category = categories.find(c => c.id == product.category);
                            const profit = product.price - (product.cost || 0);
                            return `
                                <tr>
                                    <td><img src="${product.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'50\' height=\'50\'%3E%3Crect fill=\'%23ddd\' width=\'50\' height=\'50\'/%3E%3C/svg%3E'}" style="width: 50px; height: 50px; object-fit: cover; border-radius: 8px;" alt="${product.name}"></td>
                                    <td>${product.name}</td>
                                    <td>${category ? category.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td>
                                    <td>${formatNumber(product.cost || 0)} Ø¯.Ø¹</td>
                                    <td>${formatNumber(product.price)} Ø¯.Ø¹</td>
                                    <td style="color: var(--success-color);">${formatNumber(profit)} Ø¯.Ø¹</td>
                                    <td>${product.addedBy || 'admin'}</td>
                                    <td>
                                        <button class="btn btn-sm btn-info" onclick='viewProductDetails(${JSON.stringify(product)})' title="Ø¹Ø±Ø¶">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="editProduct(${product.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteProduct(${product.id})" title="Ø­Ø°Ù">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function viewProductDetails(product) {
            const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
            const category = categories.find(c => c.id == product.category);
            const profit = product.price - (product.cost || 0);

            const html = `
                <div style="text-align: center;">
                    <img src="${product.image || 'data:image/svg+xml,%3Csvg xmlns=\'http://www.w3.org/2000/svg\' width=\'200\' height=\'200\'%3E%3Crect fill=\'%23ddd\' width=\'200\' height=\'200\'/%3E%3C/svg%3E'}" style="max-width: 100%; max-height: 200px; border-radius: 12px; margin-bottom: 20px;" alt="${product.name}">
                </div>
                <table style="width: 100%;">
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø§Ø³Ù…:</td><td style="padding: 10px;">${product.name}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„ØªØµÙ†ÙŠÙ:</td><td style="padding: 10px;">${category ? category.name : 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„ØªÙƒÙ„ÙØ©:</td><td style="padding: 10px;">${formatNumber(product.cost || 0)} Ø¯.Ø¹</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø³Ø¹Ø±:</td><td style="padding: 10px;">${formatNumber(product.price)} Ø¯.Ø¹</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø±Ø¨Ø­:</td><td style="padding: 10px; color: var(--success-color);">${formatNumber(profit)} Ø¯.Ø¹</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„ÙˆØµÙ:</td><td style="padding: 10px;">${product.description || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ù…Ù† Ø£Ø¶Ø§ÙÙ‡:</td><td style="padding: 10px;">${product.addedBy || 'admin'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</td><td style="padding: 10px;">${formatDate(product.createdAt || product.updatedAt)}</td></tr>
                </table>
            `;

            document.getElementById('detailsModalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
            document.getElementById('detailsContent').innerHTML = html;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function editProduct(id) {
            const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
            const product = products.find(p => p.id == id);
            
            if (product) {
                document.getElementById('productModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…Ù†ØªØ¬';
                document.getElementById('productId').value = product.id;
                document.getElementById('productName').value = product.name;
                document.getElementById('productCategory').value = product.category;
                document.getElementById('productCost').value = product.cost || 0;
                document.getElementById('productPrice').value = product.price;
                document.getElementById('productDescription').value = product.description || '';
                
                if (product.image) {
                    const preview = document.getElementById('productImagePreview');
                    preview.src = product.image;
                    preview.classList.remove('hidden');
                }
                
                loadCategoriesForProduct();
                document.getElementById('productModal').style.display = 'block';
            }
        }

        function deleteProduct(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…Ù†ØªØ¬ØŸ')) {
                const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
                const updated = products.filter(p => p.id !== id);
                LocalDB.save(LocalDB.KEYS.PRODUCTS, updated);
                loadProducts();
                updateProductStats();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…Ù†ØªØ¬ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        function updateProductStats() {
            const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
            
            document.getElementById('totalProducts').textContent = products.length;
            
            if (products.length > 0) {
                const avgPrice = products.reduce((sum, p) => sum + p.price, 0) / products.length;
                const avgCost = products.reduce((sum, p) => sum + (p.cost || 0), 0) / products.length;
                const avgProfit = avgPrice - avgCost;
                
                document.getElementById('avgPrice').textContent = formatNumber(avgPrice) + ' Ø¯.Ø¹';
                document.getElementById('avgCost').textContent = formatNumber(avgCost) + ' Ø¯.Ø¹';
                document.getElementById('avgProfit').textContent = formatNumber(avgProfit) + ' Ø¯.Ø¹';
            } else {
                document.getElementById('avgPrice').textContent = '0 Ø¯.Ø¹';
                document.getElementById('avgCost').textContent = '0 Ø¯.Ø¹';
                document.getElementById('avgProfit').textContent = '0 Ø¯.Ø¹';
            }
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØªØµÙ†ÙŠÙØ§Øª
        function showAddCategoryModal() {
            document.getElementById('categoryModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© ØªØµÙ†ÙŠÙ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('categoryId').value = '';
            document.getElementById('categoryModal').querySelector('form').reset();
            document.getElementById('categoryModal').style.display = 'block';
        }

        function saveCategory(event) {
            event.preventDefault();
            
            const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
            const id = document.getElementById('categoryId').value;
            
            const categoryData = {
                name: document.getElementById('categoryName').value,
                description: document.getElementById('categoryDescription').value,
                addedBy: currentUser ? currentUser.username : 'admin',
                updatedAt: new Date().toISOString()
            };

            if (id) {
                const index = categories.findIndex(c => c.id == id);
                if (index !== -1) {
                    categories[index] = { ...categories[index], ...categoryData };
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            } else {
                categoryData.id = Date.now();
                categoryData.createdAt = new Date().toISOString();
                categories.push(categoryData);
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            LocalDB.save(LocalDB.KEYS.CATEGORIES, categories);
            closeModal('categoryModal');
            loadCategories();
            autoSyncToCloud(); // Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            event.target.reset();
        }

        function loadCategories() {
            const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
            const container = document.getElementById('categoriesTableContainer');

            if (categories.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØµÙ†ÙŠÙØ§Øª</p>';
                return;
            }

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø§Ø³Ù…</th>
                            <th>Ø§Ù„ÙˆØµÙ</th>
                            <th>Ù…Ù† Ø£Ø¶Ø§ÙÙ‡</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${categories.map(cat => `
                            <tr>
                                <td>${cat.name}</td>
                                <td>${cat.description || '-'}</td>
                                <td>${cat.addedBy || 'admin'}</td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick='viewCategoryDetails(${JSON.stringify(cat)})' title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-warning" onclick="editCategory(${cat.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteCategory(${cat.id})" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function viewCategoryDetails(category) {
            const html = `
                <table style="width: 100%;">
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø§Ø³Ù…:</td><td style="padding: 10px;">${category.name}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„ÙˆØµÙ:</td><td style="padding: 10px;">${category.description || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ù…Ù† Ø£Ø¶Ø§ÙÙ‡:</td><td style="padding: 10px;">${category.addedBy || 'admin'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</td><td style="padding: 10px;">${formatDate(category.createdAt || category.updatedAt)}</td></tr>
                </table>
            `;

            document.getElementById('detailsModalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙ';
            document.getElementById('detailsContent').innerHTML = html;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function editCategory(id) {
            const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
            const category = categories.find(c => c.id == id);
            
            if (category) {
                document.getElementById('categoryModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„ØªØµÙ†ÙŠÙ';
                document.getElementById('categoryId').value = category.id;
                document.getElementById('categoryName').value = category.name;
                document.getElementById('categoryDescription').value = category.description || '';
                document.getElementById('categoryModal').style.display = 'block';
            }
        }

        function deleteCategory(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØµÙ†ÙŠÙØŸ')) {
                const categories = LocalDB.get(LocalDB.KEYS.CATEGORIES) || [];
                const updated = categories.filter(c => c.id !== id);
                LocalDB.save(LocalDB.KEYS.CATEGORIES, updated);
                loadCategories();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØµÙ†ÙŠÙ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ
        function showAddExpenseModal() {
            document.getElementById('expenseModalTitle').textContent = 'Ø¥Ø¶Ø§ÙØ© Ù…ØµØ±ÙˆÙ Ø¬Ø¯ÙŠØ¯';
            document.getElementById('expenseId').value = '';
            document.getElementById('expenseModal').querySelector('form').reset();
            document.getElementById('expenseDate').valueAsDate = new Date();
            document.getElementById('expenseModal').style.display = 'block';
        }

        function saveExpense(event) {
            event.preventDefault();
            
            const expenses = LocalDB.get(LocalDB.KEYS.EXPENSES) || [];
            const id = document.getElementById('expenseId').value;
            
            const amount = parseFloat(document.getElementById('expenseAmount').value);
            const paid = parseFloat(document.getElementById('expensePaid').value) || 0;
            
            const expenseData = {
                title: document.getElementById('expenseTitle').value,
                amount: amount,
                paid: paid,
                remaining: amount - paid,
                date: document.getElementById('expenseDate').value,
                description: document.getElementById('expenseDescription').value,
                addedBy: currentUser ? currentUser.username : 'admin',
                updatedAt: new Date().toISOString()
            };

            if (id) {
                const index = expenses.findIndex(e => e.id == id);
                if (index !== -1) {
                    expenses[index] = { ...expenses[index], ...expenseData };
                    showNotification('ØªÙ… ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            } else {
                expenseData.id = Date.now();
                expenseData.createdAt = new Date().toISOString();
                expenses.push(expenseData);
                showNotification('ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }

            LocalDB.save(LocalDB.KEYS.EXPENSES, expenses);
            closeModal('expenseModal');
            loadExpenses();
            updateDashboardStats();
            autoSyncToCloud(); // Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
            event.target.reset();
        }

        function loadExpenses() {
            const expenses = LocalDB.get(LocalDB.KEYS.EXPENSES) || [];
            const container = document.getElementById('expensesTableContainer');
            
            let filteredExpenses = [...expenses];

            const searchTerm = document.getElementById('searchExpenses')?.value.toLowerCase();
            if (searchTerm) {
                filteredExpenses = filteredExpenses.filter(e => 
                    e.title.toLowerCase().includes(searchTerm) ||
                    e.description?.toLowerCase().includes(searchTerm)
                );
            }

            const dateFrom = document.getElementById('expensesDateFrom')?.value;
            const dateTo = document.getElementById('expensesDateTo')?.value;
            
            if (dateFrom) {
                filteredExpenses = filteredExpenses.filter(e => e.date >= dateFrom);
            }
            if (dateTo) {
                filteredExpenses = filteredExpenses.filter(e => e.date <= dateTo);
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const totalCount = filteredExpenses.length;
            const totalAmount = filteredExpenses.reduce((sum, e) => sum + e.amount, 0);
            const paidAmount = filteredExpenses.reduce((sum, e) => sum + (e.paid || 0), 0);
            const remainingAmount = totalAmount - paidAmount;

            document.getElementById('totalExpensesCount').textContent = totalCount;
            document.getElementById('totalExpensesAmount').textContent = formatNumber(totalAmount) + ' Ø¯.Ø¹';
            document.getElementById('paidExpenses').textContent = formatNumber(paidAmount) + ' Ø¯.Ø¹';
            document.getElementById('remainingExpenses').textContent = formatNumber(remainingAmount) + ' Ø¯.Ø¹';

            if (filteredExpenses.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ Ù…ØµØ§Ø±ÙŠÙ</p>';
                return;
            }

            filteredExpenses.sort((a, b) => new Date(b.date) - new Date(a.date));

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                            <th>Ø§Ù„Ù…Ø¨Ù„Øº</th>
                            <th>Ø§Ù„Ù…Ø¯ÙÙˆØ¹</th>
                            <th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ù…Ù† Ø£Ø¶Ø§ÙÙ‡</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredExpenses.map(expense => {
                            const remaining = expense.amount - (expense.paid || 0);
                            return `
                                <tr>
                                    <td>${expense.title}</td>
                                    <td>${formatNumber(expense.amount)} Ø¯.Ø¹</td>
                                    <td style="color: var(--success-color);">${formatNumber(expense.paid || 0)} Ø¯.Ø¹</td>
                                    <td style="color: ${remaining > 0 ? 'var(--danger-color)' : 'var(--success-color)'};">${formatNumber(remaining)} Ø¯.Ø¹</td>
                                    <td>${formatDate(expense.date)}</td>
                                    <td>${expense.addedBy || 'admin'}</td>
                                    <td>
                                        <button class="btn btn-sm btn-info" onclick='viewExpenseDetails(${JSON.stringify(expense)})' title="Ø¹Ø±Ø¶">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-sm btn-warning" onclick="editExpense(${expense.id})" title="ØªØ¹Ø¯ÙŠÙ„">
                                            <i class="fas fa-edit"></i>
                                        </button>
                                        <button class="btn btn-sm btn-danger" onclick="deleteExpense(${expense.id})" title="Ø­Ø°Ù">
                                            <i class="fas fa-trash"></i>
                                        </button>
                                    </td>
                                </tr>
                            `;
                        }).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function viewExpenseDetails(expense) {
            const remaining = expense.amount - (expense.paid || 0);
            
            const html = `
                <table style="width: 100%;">
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</td><td style="padding: 10px;">${expense.title}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</td><td style="padding: 10px;">${formatNumber(expense.amount)} Ø¯.Ø¹</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø¯ÙÙˆØ¹:</td><td style="padding: 10px; color: var(--success-color);">${formatNumber(expense.paid || 0)} Ø¯.Ø¹</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ:</td><td style="padding: 10px; color: ${remaining > 0 ? 'var(--danger-color)' : 'var(--success-color)'};">${formatNumber(remaining)} Ø¯.Ø¹</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„ØªØ§Ø±ÙŠØ®:</td><td style="padding: 10px;">${formatDate(expense.date)}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ø§Ù„ÙˆØµÙ:</td><td style="padding: 10px;">${expense.description || '-'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">Ù…Ù† Ø£Ø¶Ø§ÙÙ‡:</td><td style="padding: 10px;">${expense.addedBy || 'admin'}</td></tr>
                    <tr><td style="font-weight: 700; padding: 10px;">ØªØ§Ø±ÙŠØ® Ø§Ù„Ø¥Ø¶Ø§ÙØ©:</td><td style="padding: 10px;">${formatDate(expense.createdAt || expense.updatedAt)}</td></tr>
                </table>
            `;

            document.getElementById('detailsModalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ';
            document.getElementById('detailsContent').innerHTML = html;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function editExpense(id) {
            const expenses = LocalDB.get(LocalDB.KEYS.EXPENSES) || [];
            const expense = expenses.find(e => e.id == id);
            
            if (expense) {
                document.getElementById('expenseModalTitle').textContent = 'ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ù…ØµØ±ÙˆÙ';
                document.getElementById('expenseId').value = expense.id;
                document.getElementById('expenseTitle').value = expense.title;
                document.getElementById('expenseAmount').value = expense.amount;
                document.getElementById('expensePaid').value = expense.paid || 0;
                document.getElementById('expenseDate').value = expense.date;
                document.getElementById('expenseDescription').value = expense.description || '';
                document.getElementById('expenseModal').style.display = 'block';
            }
        }

        function deleteExpense(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ù…ØµØ±ÙˆÙØŸ')) {
                const expenses = LocalDB.get(LocalDB.KEYS.EXPENSES) || [];
                const updated = expenses.filter(e => e.id !== id);
                LocalDB.save(LocalDB.KEYS.EXPENSES, updated);
                loadExpenses();
                updateDashboardStats();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„Ù…ØµØ±ÙˆÙ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ÙÙˆØ§ØªÙŠØ±
        function loadInvoices() {
            const invoices = LocalDB.get(LocalDB.KEYS.INVOICES) || [];
            const container = document.getElementById('invoicesTableContainer');

            let filteredInvoices = [...invoices];

            const dateFrom = document.getElementById('invoicesDateFrom')?.value;
            const dateTo = document.getElementById('invoicesDateTo')?.value;
            
            if (dateFrom) {
                filteredInvoices = filteredInvoices.filter(inv => inv.date >= dateFrom);
            }
            if (dateTo) {
                filteredInvoices = filteredInvoices.filter(inv => inv.date <= dateTo);
            }

            // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
            const totalInv = filteredInvoices.length;
            const totalSales = filteredInvoices.reduce((sum, inv) => sum + inv.total, 0);
            const totalProfit = filteredInvoices.reduce((sum, inv) => sum + (inv.profit || 0), 0);
            const margin = totalSales > 0 ? (totalProfit / totalSales * 100).toFixed(2) : 0;

            document.getElementById('totalInvoices').textContent = totalInv;
            document.getElementById('totalSales').textContent = formatNumber(totalSales) + ' Ø¯.Ø¹';
            document.getElementById('totalProfitInvoices').textContent = formatNumber(totalProfit) + ' Ø¯.Ø¹';
            document.getElementById('profitMargin').textContent = margin + '%';

            if (filteredInvoices.length === 0) {
                container.innerHTML = '<p style="text-align: center; padding: 20px;">Ù„Ø§ ØªÙˆØ¬Ø¯ ÙÙˆØ§ØªÙŠØ±</p>';
                return;
            }

            filteredInvoices.sort((a, b) => b.id - a.id);

            const table = `
                <table>
                    <thead>
                        <tr>
                            <th>Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©</th>
                            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                            <th>Ø§Ù„ÙˆÙ‚Øª</th>
                            <th>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                            <th>Ø§Ù„Ø±Ø¨Ø­</th>
                            <th>Ø§Ù„Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${filteredInvoices.map(invoice => `
                            <tr>
                                <td>#${invoice.id}</td>
                                <td>${formatDate(invoice.date)}</td>
                                <td>${invoice.time || '-'}</td>
                                <td>${formatNumber(invoice.total)} Ø¯.Ø¹</td>
                                <td style="color: var(--success-color);">${formatNumber(invoice.profit || 0)} Ø¯.Ø¹</td>
                                <td>
                                    <button class="btn btn-sm btn-info" onclick='viewInvoiceDetails(${JSON.stringify(invoice)})' title="Ø¹Ø±Ø¶">
                                        <i class="fas fa-eye"></i>
                                    </button>
                                    <button class="btn btn-sm btn-danger" onclick="deleteInvoice(${invoice.id})" title="Ø­Ø°Ù">
                                        <i class="fas fa-trash"></i>
                                    </button>
                                </td>
                            </tr>
                        `).join('')}
                    </tbody>
                </table>
            `;

            container.innerHTML = table;
        }

        function viewInvoiceDetails(invoice) {
            const itemsHtml = invoice.items.map(item => `
                <tr>
                    <td style="padding: 10px;">${item.name}</td>
                    <td style="padding: 10px;">${item.quantity}</td>
                    <td style="padding: 10px;">${formatNumber(item.price)} Ø¯.Ø¹</td>
                    <td style="padding: 10px;">${formatNumber(item.price * item.quantity)} Ø¯.Ø¹</td>
                </tr>
            `).join('');

            const html = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <h3>ÙØ§ØªÙˆØ±Ø© Ø±Ù‚Ù… #${invoice.id}</h3>
                    <p>${formatDate(invoice.date)} - ${invoice.time || '-'}</p>
                </div>
                <table style="width: 100%; border-collapse: collapse;">
                    <thead style="background: var(--bg-tertiary);">
                        <tr>
                            <th style="padding: 10px; text-align: right;">Ø§Ù„Ù…Ù†ØªØ¬</th>
                            <th style="padding: 10px; text-align: right;">Ø§Ù„ÙƒÙ…ÙŠØ©</th>
                            <th style="padding: 10px; text-align: right;">Ø§Ù„Ø³Ø¹Ø±</th>
                            <th style="padding: 10px; text-align: right;">Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ</th>
                        </tr>
                    </thead>
                    <tbody>
                        ${itemsHtml}
                    </tbody>
                </table>
                <div style="margin-top: 20px; padding: 15px; background: var(--bg-tertiary); border-radius: 8px;">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <strong>Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ:</strong>
                        <span>${formatNumber(invoice.total)} Ø¯.Ø¹</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; margin-bottom: 10px;">
                        <strong>Ø§Ù„ØªÙƒÙ„ÙØ©:</strong>
                        <span>${formatNumber(invoice.cost || 0)} Ø¯.Ø¹</span>
                    </div>
                    <div style="display: flex; justify-content: space-between; color: var(--success-color); font-size: 18px;">
                        <strong>Ø§Ù„Ø±Ø¨Ø­:</strong>
                        <span>${formatNumber(invoice.profit || 0)} Ø¯.Ø¹</span>
                    </div>
                </div>
            `;

            document.getElementById('detailsModalTitle').textContent = 'ØªÙØ§ØµÙŠÙ„ Ø§Ù„ÙØ§ØªÙˆØ±Ø©';
            document.getElementById('detailsContent').innerHTML = html;
            document.getElementById('detailsModal').style.display = 'block';
        }

        function deleteInvoice(id) {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ÙØ§ØªÙˆØ±Ø©ØŸ')) {
                const invoices = LocalDB.get(LocalDB.KEYS.INVOICES) || [];
                const updated = invoices.filter(i => i.id !== id);
                LocalDB.save(LocalDB.KEYS.INVOICES, updated);
                loadInvoices();
                updateDashboardStats();
                showNotification('ØªÙ… Ø­Ø°Ù Ø§Ù„ÙØ§ØªÙˆØ±Ø© Ø¨Ù†Ø¬Ø§Ø­', 'success');
            }
        }

        // Ø§Ù„ØªÙ‚Ø§Ø±ÙŠØ± ÙˆØ§Ù„Ø±Ø³ÙˆÙ… Ø§Ù„Ø¨ÙŠØ§Ù†ÙŠØ©
        function loadReports() {
            const invoices = LocalDB.get(LocalDB.KEYS.INVOICES) || [];
            const expenses = LocalDB.get(LocalDB.KEYS.EXPENSES) || [];

            // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ù„Ù„Ù…Ø¨ÙŠØ¹Ø§Øª
            const salesCtx = document.getElementById('salesChart');
            if (salesCtx) {
                new Chart(salesCtx, {
                    type: 'line',
                    data: {
                        labels: ['ÙŠÙ†Ø§ÙŠØ±', 'ÙØ¨Ø±Ø§ÙŠØ±', 'Ù…Ø§Ø±Ø³', 'Ø£Ø¨Ø±ÙŠÙ„', 'Ù…Ø§ÙŠÙˆ', 'ÙŠÙˆÙ†ÙŠÙˆ'],
                        datasets: [{
                            label: 'Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª',
                            data: [12000, 19000, 15000, 25000, 22000, 30000],
                            borderColor: 'rgb(124, 58, 237)',
                            tension: 0.1
                        }]
                    }
                });
            }

            // Ø±Ø³Ù… Ø¨ÙŠØ§Ù†ÙŠ Ø¯Ø§Ø¦Ø±ÙŠ Ù„Ù„Ø£Ø±Ø¨Ø§Ø­
            const profitCtx = document.getElementById('profitChart');
            if (profitCtx) {
                const totalSales = invoices.reduce((sum, inv) => sum + inv.total, 0);
                const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
                const profit = totalSales - totalExpenses;

                new Chart(profitCtx, {
                    type: 'pie',
                    data: {
                        labels: ['Ø§Ù„Ù…Ø¨ÙŠØ¹Ø§Øª', 'Ø§Ù„Ù…ØµØ§Ø±ÙŠÙ', 'Ø§Ù„Ø±Ø¨Ø­'],
                        datasets: [{
                            data: [totalSales, totalExpenses, profit],
                            backgroundColor: [
                                'rgb(124, 58, 237)',
                                'rgb(231, 76, 60)',
                                'rgb(39, 174, 96)'
                            ]
                        }]
                    }
                });
            }
        }

        // Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
        function uploadLogo(event) {
            const file = event.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('logoPreview');
                    preview.src = e.target.result;
                    preview.classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        function saveSettings() {
            const settings = {
                restaurantName: document.getElementById('restaurantName').value,
                restaurantAddress: document.getElementById('restaurantAddress').value,
                restaurantPhone: document.getElementById('restaurantPhone').value,
                logo: document.getElementById('logoPreview').src
            };

            LocalDB.save(LocalDB.KEYS.SETTINGS, settings);
            showNotification('ØªÙ… Ø­ÙØ¸ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function loadSettings() {
            const settings = LocalDB.get(LocalDB.KEYS.SETTINGS);
            if (settings) {
                document.getElementById('restaurantName').value = settings.restaurantName || '';
                document.getElementById('restaurantAddress').value = settings.restaurantAddress || '';
                document.getElementById('restaurantPhone').value = settings.restaurantPhone || '';
                
                if (settings.logo) {
                    document.getElementById('logoPreview').src = settings.logo;
                    document.getElementById('logoPreview').classList.remove('hidden');
                }
            }
        }

        // Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø§Ø­ØªÙŠØ§Ø·ÙŠ
        function exportData() {
            const data = {
                products: LocalDB.get(LocalDB.KEYS.PRODUCTS) || [],
                categories: LocalDB.get(LocalDB.KEYS.CATEGORIES) || [],
                invoices: LocalDB.get(LocalDB.KEYS.INVOICES) || [],
                expenses: LocalDB.get(LocalDB.KEYS.EXPENSES) || [],
                employees: LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [],
                users: LocalDB.get(LocalDB.KEYS.USERS) || [],
                settings: LocalDB.get(LocalDB.KEYS.SETTINGS) || {},
                exportDate: new Date().toISOString()
            };

            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `restaurant_backup_${new Date().getTime()}.json`;
            link.click();
            URL.revokeObjectURL(url);

            showNotification('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ Excel
        function exportToExcel(type) {
            let data = [];
            let filename = '';
            let headers = [];

            switch(type) {
                case 'products':
                    data = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
                    filename = 'products';
                    headers = ['Ø§Ù„Ø§Ø³Ù…', 'Ø§Ù„ØªØµÙ†ÙŠÙ', 'Ø§Ù„ØªÙƒÙ„ÙØ©', 'Ø§Ù„Ø³Ø¹Ø±', 'Ø§Ù„Ø±Ø¨Ø­', 'Ø§Ù„ÙˆØµÙ'];
                    data = data.map(p => ({
                        'Ø§Ù„Ø§Ø³Ù…': p.name,
                        'Ø§Ù„ØªØµÙ†ÙŠÙ': p.category,
                        'Ø§Ù„ØªÙƒÙ„ÙØ©': p.cost || 0,
                        'Ø§Ù„Ø³Ø¹Ø±': p.price,
                        'Ø§Ù„Ø±Ø¨Ø­': p.price - (p.cost || 0),
                        'Ø§Ù„ÙˆØµÙ': p.description || ''
                    }));
                    break;
                case 'invoices':
                    data = LocalDB.get(LocalDB.KEYS.INVOICES) || [];
                    filename = 'invoices';
                    data = data.map(inv => ({
                        'Ø±Ù‚Ù… Ø§Ù„ÙØ§ØªÙˆØ±Ø©': inv.id,
                        'Ø§Ù„ØªØ§Ø±ÙŠØ®': inv.date,
                        'Ø§Ù„ÙˆÙ‚Øª': inv.time || '',
                        'Ø§Ù„Ø¥Ø¬Ù…Ø§Ù„ÙŠ': inv.total,
                        'Ø§Ù„ØªÙƒÙ„ÙØ©': inv.cost || 0,
                        'Ø§Ù„Ø±Ø¨Ø­': inv.profit || 0
                    }));
                    break;
                case 'expenses':
                    data = LocalDB.get(LocalDB.KEYS.EXPENSES) || [];
                    filename = 'expenses';
                    data = data.map(exp => ({
                        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': exp.title,
                        'Ø§Ù„Ù…Ø¨Ù„Øº': exp.amount,
                        'Ø§Ù„Ù…Ø¯ÙÙˆØ¹': exp.paid || 0,
                        'Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ': exp.amount - (exp.paid || 0),
                        'Ø§Ù„ØªØ§Ø±ÙŠØ®': exp.date,
                        'Ø§Ù„ÙˆØµÙ': exp.description || ''
                    }));
                    break;
                case 'employees':
                    data = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
                    filename = 'employees';
                    data = data.map(emp => ({
                        'Ø§Ù„Ø§Ø³Ù…': emp.name,
                        'Ø§Ù„Ù‡Ø§ØªÙ': emp.phone,
                        'Ø§Ù„Ø¹Ù†ÙˆØ§Ù†': emp.address || '',
                        'Ø§Ù„Ù…Ù†ØµØ¨': emp.position || '',
                        'Ø§Ù„Ø±Ø§ØªØ¨': emp.salary,
                        'ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ¹ÙŠÙŠÙ†': emp.hireDate
                    }));
                    break;
            }

            if (data.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
                return;
            }

            const ws = XLSX.utils.json_to_sheet(data);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
            XLSX.writeFile(wb, `${filename}_${new Date().getTime()}.xlsx`);
            
            showNotification('ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        // Ø§Ù„ØªØµØ¯ÙŠØ± Ø¥Ù„Ù‰ PDF
        function exportToPDF(type) {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF({
                orientation: 'portrait',
                unit: 'mm',
                format: 'a4'
            });

            // Ø¥Ø¶Ø§ÙØ© Ø®Ø· Ø¹Ø±Ø¨ÙŠ (Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø®Ø· Ø§ÙØªØ±Ø§Ø¶ÙŠ)
            doc.setFont('helvetica');
            doc.setFontSize(16);
            
            let title = '';
            let headers = [];
            let data = [];

            switch(type) {
                case 'products':
                    title = 'Products Report';
                    headers = [['Name', 'Category', 'Cost', 'Price', 'Profit']];
                    const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
                    data = products.map(p => [
                        p.name,
                        p.category,
                        formatNumber(p.cost || 0),
                        formatNumber(p.price),
                        formatNumber(p.price - (p.cost || 0))
                    ]);
                    break;
                case 'invoices':
                    title = 'Invoices Report';
                    headers = [['Invoice #', 'Date', 'Time', 'Total', 'Profit']];
                    const invoices = LocalDB.get(LocalDB.KEYS.INVOICES) || [];
                    data = invoices.map(inv => [
                        inv.id,
                        inv.date,
                        inv.time || '',
                        formatNumber(inv.total),
                        formatNumber(inv.profit || 0)
                    ]);
                    break;
                case 'expenses':
                    title = 'Expenses Report';
                    headers = [['Title', 'Amount', 'Paid', 'Remaining', 'Date']];
                    const expenses = LocalDB.get(LocalDB.KEYS.EXPENSES) || [];
                    data = expenses.map(exp => [
                        exp.title,
                        formatNumber(exp.amount),
                        formatNumber(exp.paid || 0),
                        formatNumber(exp.amount - (exp.paid || 0)),
                        exp.date
                    ]);
                    break;
                case 'employees':
                    title = 'Employees Report';
                    headers = [['Name', 'Phone', 'Position', 'Salary', 'Hire Date']];
                    const employees = LocalDB.get(LocalDB.KEYS.EMPLOYEES) || [];
                    data = employees.map(emp => [
                        emp.name,
                        emp.phone,
                        emp.position || '',
                        formatNumber(emp.salary),
                        emp.hireDate
                    ]);
                    break;
            }

            if (data.length === 0) {
                showNotification('Ù„Ø§ ØªÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª Ù„Ù„ØªØµØ¯ÙŠØ±', 'warning');
                return;
            }

            doc.text(title, 105, 15, { align: 'center' });
            
            doc.autoTable({
                head: headers,
                body: data,
                startY: 25,
                theme: 'grid',
                styles: { font: 'helvetica', fontSize: 10 }
            });

            doc.save(`${type}_report_${new Date().getTime()}.pdf`);
            showNotification('ØªÙ… Ø§Ù„ØªØµØ¯ÙŠØ± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function importData(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    
                    if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§ØªØŸ Ø³ÙŠØªÙ… Ø§Ø³ØªØ¨Ø¯Ø§Ù„ Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø­Ø§Ù„ÙŠØ©.')) {
                        if (data.products) LocalDB.save(LocalDB.KEYS.PRODUCTS, data.products);
                        if (data.categories) LocalDB.save(LocalDB.KEYS.CATEGORIES, data.categories);
                        if (data.invoices) LocalDB.save(LocalDB.KEYS.INVOICES, data.invoices);
                        if (data.expenses) LocalDB.save(LocalDB.KEYS.EXPENSES, data.expenses);
                        if (data.employees) LocalDB.save(LocalDB.KEYS.EMPLOYEES, data.employees);
                        if (data.users) LocalDB.save(LocalDB.KEYS.USERS, data.users);
                        if (data.settings) LocalDB.save(LocalDB.KEYS.SETTINGS, data.settings);

                        showNotification('ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        updateDashboardStats();
                        showPage('homePage');
                    }
                } catch (error) {
                    showNotification('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                }
            };
            reader.readAsText(file);
        }

        // Ø¯ÙˆØ§Ù„ Ø§Ù„Ù†Ø³Ø® Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠ
        function showCloudSubscriptionModal() {
            const cloudConfig = LocalDB.get(LocalDB.KEYS.CLOUD_CONFIG);
            
            if (cloudConfig && cloudConfig.subscriptionCode) {
                showNotification('Ø£Ù†Øª Ù…Ø´ØªØ±Ùƒ Ø¨Ø§Ù„ÙØ¹Ù„ ÙÙŠ Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©', 'info');
                return;
            }
            
            document.getElementById('subscriptionStep1').classList.remove('hidden');
            document.getElementById('subscriptionStep2').classList.add('hidden');
            document.getElementById('cloudSubscriptionModal').style.display = 'block';
        }

        function submitSubscription(event) {
            event.preventDefault();
            
            const username = document.getElementById('cloudUsername').value;
            const phone = document.getElementById('cloudPhone').value;
            const restaurantName = document.getElementById('cloudRestaurantName').value;
            const address = document.getElementById('cloudAddress').value;

            // Ø¥Ù†Ø´Ø§Ø¡ ÙƒÙˆØ¯ Ø§Ø´ØªØ±Ø§Ùƒ ÙØ±ÙŠØ¯
            const subscriptionCode = generateSubscriptionCode();
            currentUserId = 'user_' + Date.now();

            const cloudConfig = {
                username,
                phone,
                restaurantName,
                address,
                subscriptionCode,
                userId: currentUserId,
                createdAt: new Date().toISOString(),
                active: false
            };

            LocalDB.save(LocalDB.KEYS.CLOUD_CONFIG, cloudConfig);
            document.getElementById('subscriptionCode').textContent = subscriptionCode;
            document.getElementById('subscriptionStep1').classList.add('hidden');
            document.getElementById('subscriptionStep2').classList.remove('hidden');
        }

        function generateSubscriptionCode() {
            const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
            let code = '';
            for (let i = 0; i < 12; i++) {
                if (i > 0 && i % 4 === 0) code += '-';
                code += chars.charAt(Math.floor(Math.random() * chars.length));
            }
            return code;
        }

        function copySubscriptionCode() {
            const code = document.getElementById('subscriptionCode').textContent;
            navigator.clipboard.writeText(code).then(() => {
                showNotification('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯ Ø¨Ù†Ø¬Ø§Ø­', 'success');
            });
        }

        function activateCloudSubscription() {
            const cloudConfig = LocalDB.get(LocalDB.KEYS.CLOUD_CONFIG);
            if (!cloudConfig) return;

            cloudConfig.active = true;
            LocalDB.save(LocalDB.KEYS.CLOUD_CONFIG, cloudConfig);
            
            closeModal('cloudSubscriptionModal');
            updateCloudStatus();
            
            // Ø±ÙØ¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
            syncToCloud(true);
            
            showNotification('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø¨Ù†Ø¬Ø§Ø­', 'success');
        }

        function updateCloudStatus() {
            const cloudConfig = LocalDB.get(LocalDB.KEYS.CLOUD_CONFIG);
            
            if (cloudConfig && cloudConfig.active) {
                document.getElementById('cloudConnectionStatus').textContent = 'Ù…ØªØµÙ„';
                document.getElementById('cloudConnectionStatus').style.color = 'var(--success-color)';
                document.getElementById('cloudSubscribeBtn').classList.add('hidden');
                document.getElementById('cloudSyncBtn').classList.remove('hidden');
                document.getElementById('cloudDisconnectBtn').classList.remove('hidden');
                
                const lastSync = cloudConfig.lastSync;
                if (lastSync) {
                    document.getElementById('lastSyncTime').textContent = formatDate(lastSync) + ' - ' + new Date(lastSync).toLocaleTimeString('ar-IQ');
                }
            } else {
                document.getElementById('cloudConnectionStatus').textContent = 'ØºÙŠØ± Ù…ØªØµÙ„';
                document.getElementById('cloudConnectionStatus').style.color = 'var(--danger-color)';
                document.getElementById('cloudSubscribeBtn').classList.remove('hidden');
                document.getElementById('cloudSyncBtn').classList.add('hidden');
                document.getElementById('cloudDisconnectBtn').classList.add('hidden');
                document.getElementById('lastSyncTime').textContent = 'Ù„Ù… ÙŠØªÙ…';
            }
        }

        function syncToCloud(isFirstSync = false) {
            const cloudConfig = LocalDB.get(LocalDB.KEYS.CLOUD_CONFIG);
            
            if (!cloudConfig || !cloudConfig.active) {
                return; // Ù„Ø§ ØªØ²Ø§Ù…Ù† Ø¥Ø°Ø§ Ù„Ù… ÙŠÙƒÙ† Ù…ÙØ¹Ù„
            }

            if (!firebaseDB) {
                console.log('Firebase not available');
                return;
            }

            // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª (Ø¨Ø¯ÙˆÙ† Ø§Ù„ØµÙˆØ±)
            const products = (LocalDB.get(LocalDB.KEYS.PRODUCTS) || []).map(p => ({
                ...p,
                image: null // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±
            }));

            const employees = (LocalDB.get(LocalDB.KEYS.EMPLOYEES) || []).map(e => ({
                ...e,
                image: null // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØµÙˆØ±
            }));

            const allData = {
                products: products,
                categories: LocalDB.get(LocalDB.KEYS.CATEGORIES) || [],
                invoices: LocalDB.get(LocalDB.KEYS.INVOICES) || [],
                expenses: LocalDB.get(LocalDB.KEYS.EXPENSES) || [],
                employees: employees,
                users: LocalDB.get(LocalDB.KEYS.USERS) || [],
                settings: LocalDB.get(LocalDB.KEYS.SETTINGS) || {},
                config: {
                    restaurantName: cloudConfig.restaurantName,
                    phone: cloudConfig.phone,
                    address: cloudConfig.address,
                    username: cloudConfig.username
                },
                subscriptionCode: cloudConfig.subscriptionCode,
                lastUpdated: new Date().toISOString()
            };

            const userRef = firebaseDB.ref('restaurants/' + cloudConfig.userId);
            
            userRef.set(allData)
                .then(() => {
                    cloudConfig.lastSync = new Date().toISOString();
                    LocalDB.save(LocalDB.KEYS.CLOUD_CONFIG, cloudConfig);
                    updateCloudStatus();
                    if (!isFirstSync) {
                        console.log('ØªÙ…Øª Ø§Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©');
                    }
                })
                .catch((error) => {
                    console.error('Sync error:', error);
                });
        }

        // Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ© Ø¹Ù†Ø¯ Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª
        function autoSyncToCloud() {
            const cloudConfig = LocalDB.get(LocalDB.KEYS.CLOUD_CONFIG);
            if (cloudConfig && cloudConfig.active) {
                syncToCloud();
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø¯Ø§Ù„Ø© Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
        function saveProductWithSync(productData) {
            const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
            // ... Ø­ÙØ¸ Ø§Ù„Ù…Ù†ØªØ¬ ...
            LocalDB.save(LocalDB.KEYS.PRODUCTS, products);
            autoSyncToCloud(); // Ù…Ø²Ø§Ù…Ù†Ø© ØªÙ„Ù‚Ø§Ø¦ÙŠØ©
        }

        function disconnectCloud() {
            if (confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ø§Ù„Ø®Ø¯Ù…Ø© Ø§Ù„Ø³Ø­Ø§Ø¨ÙŠØ©ØŸ Ø³ÙŠØªÙ… Ø§Ù„Ø§Ø­ØªÙØ§Ø¸ Ø¨Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø­Ù„ÙŠØ©.')) {
                const cloudConfig = LocalDB.get(LocalDB.KEYS.CLOUD_CONFIG);
                if (cloudConfig) {
                    cloudConfig.active = false;
                    LocalDB.save(LocalDB.KEYS.CLOUD_CONFIG, cloudConfig);
                    updateCloudStatus();
                    showNotification('ØªÙ… Ù‚Ø·Ø¹ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
                }
            }
        }

        // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª
        function updateDashboardStats() {
            const invoices = LocalDB.get(LocalDB.KEYS.INVOICES) || [];
            const products = LocalDB.get(LocalDB.KEYS.PRODUCTS) || [];
            const expenses = LocalDB.get(LocalDB.KEYS.EXPENSES) || [];

            const today = new Date().toISOString().split('T')[0];
            const todaySales = invoices
                .filter(inv => inv.date === today)
                .reduce((sum, inv) => sum + inv.total, 0);

            const totalProfit = invoices.reduce((sum, inv) => sum + (inv.profit || 0), 0);
            const totalExpenses = expenses.reduce((sum, exp) => sum + exp.amount, 0);
            const netProfit = totalProfit - totalExpenses;

            document.getElementById('todaySales').textContent = formatNumber(todaySales) + ' Ø¯.Ø¹';
            document.getElementById('invoiceCount').textContent = invoices.length;
            document.getElementById('productCount').textContent = products.length;
            document.getElementById('netProfit').textContent = formatNumber(netProfit) + ' Ø¯.Ø¹';
        }

        // Ø¯ÙˆØ§Ù„ Ù…Ø³Ø§Ø¹Ø¯Ø©
        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function formatNumber(num) {
            return new Intl.NumberFormat('ar-IQ').format(num);
        }

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            return date.toLocaleDateString('ar-IQ', { 
                year: 'numeric', 
                month: 'long', 
                day: 'numeric' 
            });
        }

        function openWhatsApp() {
            window.open('https://wa.me/9647708967699', '_blank');
        }

        function minimizeWindow() {
            if (window.electronAPI) {
                window.electronAPI.minimize();
            }
        }

        function maximizeWindow() {
            if (window.electronAPI) {
                window.electronAPI.maximize();
            }
        }

        function closeWindow() {
            if (window.electronAPI) {
                window.electronAPI.close();
            } else {
                if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ØŸ')) {
                    window.close();
                }
            }
        }

        // Ø¥ØºÙ„Ø§Ù‚ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬Ù‡
        window.onclick = function(event) {
            if (event.target.classList.contains('modal')) {
                event.target.style.display = 'none';
            }
        };

        // Ø§Ù„ØªÙ‡ÙŠØ¦Ø© Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
        window.addEventListener('DOMContentLoaded', () => {
            loadTheme();
            loadSettings();
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø£ÙˆÙ„ÙŠ
            const isRegistered = checkAppRegistration();
            
            if (!isRegistered) {
                // Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ØºÙŠØ± Ù…Ø³Ø¬Ù„ Ø£Ùˆ Ø§Ù†ØªÙ‡Øª Ø§Ù„ÙØªØ±Ø©
                return;
            }
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù…Ø³Ø¬Ù„ Ø¯Ø®ÙˆÙ„Ù‡
            currentUser = LocalDB.get(LocalDB.KEYS.CURRENT_USER);
            if (currentUser) {
                document.getElementById('loginScreen').classList.add('hidden');
                document.getElementById('dashboard').classList.remove('hidden');
                document.getElementById('logoutBtn').classList.remove('hidden');
                document.getElementById('refreshBtn').classList.remove('hidden');
                checkUserPermissions();
                updateCloudStatus();
            }
        });
    </script>
</body>
</html>